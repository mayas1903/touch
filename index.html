<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Touch Me Softly</title>
  <style>
    body {
      position: relative;
      margin: 0;
      padding: 20px;
      background-image: url('https://i.postimg.cc/xdfHJk7x/042-FACF6-1710-454-B-84-F0-C2-D64859-AD77.jpg');
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #counter {
      font-size: 18px;
      background: #ffe6f0;
      color: #d6336c;
      border-radius: 16px;
      padding: 12px 20px;
      margin-bottom: 10px;
      box-shadow: 0 6px 15px rgba(255, 182, 193, 0.6);
      cursor: pointer;
      position: relative;
      z-index: 10;
      width: fit-content;
    }
    #counter:hover {
      background: #ffccdd;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -60%);
      background: #fefefe;
      border-radius: 20px;
      width: 270px;
      max-width: 90vw;
      padding: 20px 22px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      font-size: 16px;
      color: #111;
      text-align: center;
      box-sizing: border-box;
      user-select: none;
      word-wrap: break-word;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
      backdrop-filter: blur(10px);
    }

    .modal.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%);
    }

    .modal h2, .modal h3 {
      font-weight: 600;
      margin-bottom: 12px;
    }

    .modal p {
      margin: 6px 0;
      line-height: 1.4;
      color: #333;
    }

    .modal button {
      margin-top: 18px;
      background: #007aff;
      border: none;
      color: white;
      padding: 10px 22px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.25s ease;
    }

    .modal button:hover {
      background: #005ecb;
    }

    .heart {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      animation: floatUp 1.2s ease forwards;
      opacity: 1;
      z-index: 1000;
      font-size: 50px;
      line-height: 70px;
      text-align: center;
      user-select: none;
    }

    @keyframes floatUp {
      0% {
        transform: translateY(0) scale(1);
        opacity: 1;
      }
      100% {
        transform: translateY(-40px) scale(1.5);
        opacity: 0;
      }
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #rewardLoadingModal div {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    #rewardAvailableModal.show {
      animation: zoomInFromFar 0.6s ease forwards;
    }

    #spinner {
      animation: spin 2s linear infinite;
    }

    #confetti-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 5;
      display: none;
    }

    @keyframes sparkle {
      0%, 100% {opacity: 0.8;}
      50% {opacity: 0.4;}
    }

    @keyframes glow {
      0% { text-shadow: 0 0 10px #d6336c;}
      100% { text-shadow: 0 0 20px #ff90b3;}
    }
  </style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
  <p id="description" style="
    font-size: 15px;
    color: #d6336c;
    margin-bottom: 10px;
    text-align: center;
    max-width: 700px;
    line-height: 1.4;
    position: relative;
    animation: glow 3s ease-in-out infinite alternate;
  ">
    –û—Ç–ø—Ä–∞–≤–ª—è–π –∫–∞—Å–∞–Ω–∏—è –∏ –ø–æ—Ü–µ–ª—É–π—á–∏–∫–∏ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥—Ä—É–≥—É –∏–ª–∏ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.<br>
    –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ –Ω–∞–±–µ—Ä—ë—Ç–µ <strong>1000</strong> –∫–∞—Å–∞–Ω–∏–π, –≤–∞—Å –∂–¥—ë—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ üíù
    <span class="sparkle" style="
      position: absolute;
      top: -8px;
      right: -12px;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #ff90b3 20%, transparent 70%);
      border-radius: 50%;
      animation: sparkle 1.8s infinite ease-in-out;
      opacity: 0.8;
      pointer-events: none;
    "></span>
  </p>
  
<div id="pulseDots" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000;">
  <svg width="80" height="24" viewBox="0 0 80 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="10" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" repeatCount="indefinite"/>
    </circle>
    <circle cx="40" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.2s" repeatCount="indefinite"/>
    </circle>
    <circle cx="70" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.4s" repeatCount="indefinite"/>
    </circle>
  </svg>
</div>

  <div id="counter" role="button" aria-label="–°—á—ë—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π">–¢—ã: 0 | –î—Ä—É–≥: 0</div>

  <div id="progressModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="progressTitle" aria-describedby="progressDesc">
    <h3 id="progressTitle">üíñ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
    <p>–¢—ã: <span id="progressMy">0</span></p>
    <p>–î—Ä—É–≥: <span id="progressFriend">0</span></p>
    <p>–í—Å–µ–≥–æ: <span id="progressTotal">0</span></p>
    <p>–î–æ –ø–æ–¥–∞—Ä–∫–∞ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="progressLeft">1000</span></p>
    <button id="closeProgressBtn">–û–∫</button>
  </div>

  <div id="rewardAvailableModal" class="modal">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
    <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ <strong>1000 –∫–∞—Å–∞–Ω–∏–π</strong><br>–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–¥–∞—Ä–æ–∫!</p>
    <button id="openRewardBtn">–ü–æ–ª—É—á–∏—Ç—å</button>
  </div>

  <div id="rewardLoadingModal" class="modal">
    <h2>üéÅ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫...</h2>
    <div style="margin-top: 20px; font-size: 24px;">‚è≥</div>
  </div>

  <div id="rewardResultModal" class="modal">
    <h2>–£—Ä–∞! üéâ</h2>
    <p id="rewardResultText">–í–∞–º –≤—ã–ø–∞–ª Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!</p>
    <button id="closeRewardBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    let myTouches = 0;
    let friendTouches = 0;
    let totalTouches = 0;

    const counter = document.getElementById('counter');
    const progressModal = document.getElementById('progressModal');
    const rewardAvailableModal = document.getElementById('rewardAvailableModal');
    const rewardLoadingModal = document.getElementById('rewardLoadingModal');
    const rewardResultModal = document.getElementById('rewardResultModal');

    const progressMy = document.getElementById('progressMy');
    const progressFriend = document.getElementById('progressFriend');
    const progressTotal = document.getElementById('progressTotal');
    const progressLeft = document.getElementById('progressLeft');

    const closeProgressBtn = document.getElementById('closeProgressBtn');
    const openRewardBtn = document.getElementById('openRewardBtn');
    const closeRewardBtn = document.getElementById('closeRewardBtn');

    let lastMyTouches = 0;
    let lastFriendTouches = 0;
    let rewardClaimed = false;

    const emojis = ['üíó', 'üíï', 'üíñ', 'üíò', 'üíù', 'üíû'];

    function animateNumber(element, start, end, duration = 300) {
      const startTime = performance.now();

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentValue = Math.floor(start + (end - start) * progress);
        element.textContent = currentValue;
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      requestAnimationFrame(update);
    }

    function createRandomEmoji(x, y, emoji) {
  const emojis = ['üíó'];
  const chosenEmoji = emoji || emojis[Math.floor(Math.random() * emojis.length)];
  const span = document.createElement('span');
  span.className = 'heart';
  span.textContent = chosenEmoji;
  span.style.left = (x - 20) + 'px';
  span.style.top = (y - 20) + 'px';
  document.body.appendChild(span);
  setTimeout(() => {
    span.remove();
  }, 1200);
}

    function updateCounter() {
      counter.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
    }

    function updateProgressModal() {
  progressMy.textContent = myTouches;
  progressFriend.textContent = friendTouches;
  totalTouches = myTouches + friendTouches;
  progressTotal.textContent = totalTouches;
  progressLeft.textContent = Math.max(1000 - totalTouches, 0);
}
    function openModal(modal) {
      isModalOpen = true;
      modal.classList.add('show');
    }

    function closeModal(modal) {
       isModalOpen = false;
      modal.classList.remove('show');
    }

    function checkReward() {
      totalTouches = myTouches + friendTouches;
      if (totalTouches >= 10 && !rewardAvailableModal.classList.contains('show') && !rewardClaimed) {
        openModal(rewardAvailableModal);
      }
    }

    closeProgressBtn.onclick = () => closeModal(progressModal);
    openRewardBtn.onclick = () => {
      closeModal(rewardAvailableModal);
      openModal(rewardLoadingModal);
      setTimeout(() => {
        closeModal(rewardLoadingModal);
        showRandomReward();
      }, 2000);
    };

    function showRandomReward() {
      const gifts = [
        'Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!',
        'Telegram Premium –Ω–∞ 1 –º–µ—Å—è—Ü!',
        '–ó–≤–µ–∑–¥—ã 250 —à—Ç—É–∫!',
        '–ó–≤–µ–∑–¥—ã 500 —à—Ç—É–∫!',
      ];
      const randomGift = gifts[Math.floor(Math.random() * gifts.length)];
      document.getElementById('rewardResultText').innerHTML = `–í–∞–º –≤—ã–ø–∞–ª:<br><strong>${randomGift}</strong>`;
      openModal(rewardResultModal);
    }

    closeRewardBtn.onclick = () => {
      rewardClaimed = true;
      closeModal(rewardResultModal);
      const pulse = document.getElementById('pulseDots');
  pulse.style.display = 'block';
       setTimeout(() => {
    pulse.style.display = 'none';
    alert('–ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! üéÅ');
  }, 2000);
};

    counter.addEventListener('click', () => {
      openModal(progressModal);
    });

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º Socket.IO
const socket = io('https://immense-fantasy-turret.glitch.me'); // –∞–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
const roomId = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe)
  ? window.Telegram.WebApp.initDataUnsafe.chat.id
  : 'default_room';
socket.emit('joinRoom', roomId);
socket.on('connect', () => {
  console.log('üß† –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ WebSocket-—Å–µ—Ä–≤–µ—Ä—É');
});

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
    function sendTouch(x, y) {
      socket.emit('touch', { x, y });
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    let touchCooldown = false;
    let isModalOpen = false;
function handleTouch(x, y) {
   if (touchCooldown || isModalOpen) return;
  touchCooldown = true;
  setTimeout(() => (touchCooldown = false), 500); // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞—Å–∞–Ω–∏—è–º–∏
  myTouches++;
  updateCounter();
  createRandomEmoji(x, y);
  sendTouch(x, y);
  checkReward();
}

    // –õ–æ–≤–∏–º touchstart –∏ click (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
    document.body.addEventListener('touchstart', e => {
      if (e.target === counter) return;
      const touch = e.touches[0];
      handleTouch(touch.clientX, touch.clientY);
    });

    document.body.addEventListener('click', e => {
      if (e.target === counter) return;
      handleTouch(e.clientX, e.clientY);
    });

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –¥—Ä—É–≥–∞
   socket.on('friendTouch', ({ x, y }) => {
  friendTouches++;
  createRandomEmoji(x, y, 'üíó'); // –ø–æ–º–µ–Ω—è–ª createEmoji –Ω–∞ createRandomEmoji
 animateNumber(counter, lastFriendTouches, friendTouches);
lastFriendTouches = friendTouches;
  updateProgressModal();
  checkReward();
});

    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    const confettiCanvas = document.getElementById('confetti-canvas');
    const ctx = confettiCanvas.getContext('2d');
    let confettiParticles = [];

    function resizeCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    class ConfettiParticle {
      constructor() {
        this.x = Math.random() * confettiCanvas.width;
        this.y = Math.random() * confettiCanvas.height - confettiCanvas.height;
        this.size = 7 + Math.random() * 7;
        this.color = `hsl(${Math.random() * 360}, 70%, 60%)`;
        this.speed = 1 + Math.random() * 2;
        this.rotation = Math.random() * 360;
        this.rotationSpeed = (Math.random() - 0.5) * 10;
      }
      update() {
        this.y += this.speed;
        this.rotation += this.rotationSpeed;
        if (this.y > confettiCanvas.height) {
          this.y = -this.size;
          this.x = Math.random() * confettiCanvas.width;
        }
      }
      draw() {
        ctx.save();
        ctx.translate(this.x, this.y);
        ctx.rotate(this.rotation * Math.PI / 180);
        ctx.fillStyle = this.color;
        ctx.fillRect(-this.size / 2, -this.size / 2, this.size, this.size * 0.4);
        ctx.restore();
      }
    }

    function createConfetti(count) {
      confettiParticles = [];
      for (let i = 0; i < count; i++) {
        confettiParticles.push(new ConfettiParticle());
      }
    }

    function animateConfetti() {
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      confettiParticles.forEach(p => {
        p.update();
        p.draw();
      });
      requestAnimationFrame(animateConfetti);
    }

    // –ó–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏, –∫–æ–≥–¥–∞ –ø–æ–¥–∞—Ä–æ–∫ –æ—Ç–∫—Ä—ã—Ç
    function startConfetti() {
      createConfetti(450);
      confettiCanvas.style.display = 'block';
      animateConfetti();
      setTimeout(() => {
        confettiCanvas.style.display = 'none';
        confettiParticles = [];
      }, 3000);
    }

    // –ü—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –ø–æ–¥–∞—Ä–∫–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    openRewardBtn.addEventListener('click', () => {
      startConfetti();
    });
  </script>
</body>
</html>

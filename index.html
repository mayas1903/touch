<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Touch Me Softly</title>
  <style>
    body {
      position: relative;
      margin: 0;
      padding: 20px;
      background-image: url('https://i.postimg.cc/xdfHJk7x/042-FACF6-1710-454-B-84-F0-C2-D64859-AD77.jpg');
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #counter {
      font-size: 18px;
      background: #ffe6f0;
      color: #d6336c;
      border-radius: 16px;
      padding: 12px 20px;
      margin-bottom: 10px;
      box-shadow: 0 6px 15px rgba(255, 182, 193, 0.6);
      cursor: pointer;
      position: relative;
      z-index: 10;
      width: fit-content;
    }
    #counter:hover {
      background: #ffccdd;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -60%);
      background: #fefefe;
      border-radius: 20px;
      width: 270px;
      max-width: 90vw;
      padding: 20px 22px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      font-size: 16px;
      color: #111;
      text-align: center;
      box-sizing: border-box;
      user-select: none;
      word-wrap: break-word;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
      backdrop-filter: blur(10px);
    }

    .modal.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%);
    }

    .modal h2, .modal h3 {
      font-weight: 600;
      margin-bottom: 12px;
    }

    .modal p {
      margin: 6px 0;
      line-height: 1.4;
      color: #333;
    }

    .modal button {
      margin-top: 18px;
      background: #007aff;
      border: none;
      color: white;
      padding: 10px 22px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.25s ease;
    }

    .modal button:hover {
      background: #005ecb;
    }

    .heart {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      animation: floatUp 1.7s ease forwards;
      opacity: 1;
      z-index: 1000;
      font-size: 50px;
      line-height: 70px;
      text-align: center;
      user-select: none;
    }

    @keyframes floatUp {
  0% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  40% {
    transform: translateY(-30px) scale(1.3);
    opacity: 1;
  }
  100% {
    transform: translateY(-80px) scale(1.7);
    opacity: 0;
  }
}

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #rewardLoadingModal div {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    #rewardAvailableModal.show {
      animation: zoomInFromFar 0.6s ease forwards;
    }

    #spinner {
      animation: spin 2s linear infinite;
    }

    #confetti-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 5;
      display: none;
    }

    @keyframes sparkle {
      0%, 100% {opacity: 0.8;}
      50% {opacity: 0.4;}
    }

    @keyframes glow {
      0% { text-shadow: 0 0 10px #d6336c;}
      100% { text-shadow: 0 0 20px #ff90b3;}
    }
  </style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
  <p id="description" style="
    font-size: 15px;
    color: #d6336c;
    margin-bottom: 10px;
    text-align: center;
    max-width: 700px;
    line-height: 1.4;
    position: relative;
    animation: glow 3s ease-in-out infinite alternate;
  ">
    –û—Ç–ø—Ä–∞–≤–ª—è–π –∫–∞—Å–∞–Ω–∏—è –∏ –ø–æ—Ü–µ–ª—É–π—á–∏–∫–∏ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥—Ä—É–≥—É –∏–ª–∏ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.<br>
    –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ –Ω–∞–±–µ—Ä—ë—Ç–µ <strong>1000</strong> –∫–∞—Å–∞–Ω–∏–π, –≤–∞—Å –∂–¥—ë—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ üíù
    <span class="sparkle" style="
      position: absolute;
      top: -8px;
      right: -12px;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #ff90b3 20%, transparent 70%);
      border-radius: 50%;
      animation: sparkle 1.8s infinite ease-in-out;
      opacity: 0.8;
      pointer-events: none;
    "></span>
  </p>
  
<div id="pulseDots" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000;">
  <svg width="80" height="24" viewBox="0 0 80 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="10" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" repeatCount="indefinite"/>
    </circle>
    <circle cx="40" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.2s" repeatCount="indefinite"/>
    </circle>
    <circle cx="70" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.4s" repeatCount="indefinite"/>
    </circle>
  </svg>
</div>

  <div id="counter" role="button" aria-label="–°—á—ë—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π">–¢—ã: 0 | –î—Ä—É–≥: 0</div>

  <div id="progressModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="progressTitle" aria-describedby="progressDesc">
    <h3 id="progressTitle">üíñ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
    <p>–¢—ã: <span id="progressMy">0</span></p>
    <p>–î—Ä—É–≥: <span id="progressFriend">0</span></p>
    <p>–í—Å–µ–≥–æ: <span id="progressTotal">0</span></p>
    <p>–î–æ –ø–æ–¥–∞—Ä–∫–∞ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="progressLeft">1000</span></p>
    <button id="closeProgressBtn">–û–∫</button>
  </div>

  <div id="rewardAvailableModal" class="modal">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
    <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ <strong>1000 –∫–∞—Å–∞–Ω–∏–π</strong><br>–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–¥–∞—Ä–æ–∫!</p>
    <button id="openRewardBtn">–ü–æ–ª—É—á–∏—Ç—å</button>
  </div>

  <div id="rewardLoadingModal" class="modal">
    <h2>üéÅ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫...</h2>
    <div style="margin-top: 20px; font-size: 24px;">‚è≥</div>
  </div>

  <div id="rewardResultModal" class="modal">
    <h2>–£—Ä–∞! üéâ</h2>
    <p id="rewardResultText">–í–∞–º –≤—ã–ø–∞–ª Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!</p>
    <button id="closeRewardBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    let myTouches = 0;
    let friendTouches = 0;
    let totalTouches = 0;

    const counter = document.getElementById('counter');
    const progressModal = document.getElementById('progressModal');
    const rewardAvailableModal = document.getElementById('rewardAvailableModal');
    const rewardLoadingModal = document.getElementById('rewardLoadingModal');
    const rewardResultModal = document.getElementById('rewardResultModal');

    const progressMy = document.getElementById('progressMy');
    const progressFriend = document.getElementById('progressFriend');
    const progressTotal = document.getElementById('progressTotal');
    const progressLeft = document.getElementById('progressLeft');

    const closeProgressBtn = document.getElementById('closeProgressBtn');
    const openRewardBtn = document.getElementById('openRewardBtn');
    const closeRewardBtn = document.getElementById('closeRewardBtn');

    let lastMyTouches = 0;
    let lastFriendTouches = 0;
    let rewardClaimed = false;

    const emojis = ['üíó', 'üíï', 'üíñ', 'üíò', 'üíù', 'üíû'];

    function animateNumber(element, start, end, duration = 300) {
      const startTime = performance.now();

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentValue = Math.floor(start + (end - start) * progress);
        element.textContent = currentValue;
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      requestAnimationFrame(update);
    }

    function createRandomEmoji(x, y, emoji) {
  const emojis = ['üíó'];
  const chosenEmoji = emoji || emojis[Math.floor(Math.random() * emojis.length)];
  const span = document.createElement('span');
  span.className = 'heart';
  span.textContent = chosenEmoji;
  span.style.left = (x - 20) + 'px';
  span.style.top = (y - 20) + 'px';
  document.body.appendChild(span);
  setTimeout(() => {
    span.remove();
  }, 1700);
}

    function updateCounter() {
      counter.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
    }

    function updateProgressModal() {
  progressMy.textContent = myTouches;
  progressFriend.textContent = friendTouches;
  totalTouches = myTouches + friendTouches;
  progressTotal.textContent = totalTouches;
  progressLeft.textContent = Math.max(1000 - totalTouches, 0);
}
    function openModal(modal) {
      isModalOpen = true;
      modal.classList.add('show');
    }

    function closeModal(modal) {
       isModalOpen = false;
      modal.classList.remove('show');
    }

    function checkReward() {
      totalTouches = myTouches + friendTouches;
      if (totalTouches >= 10 && !rewardAvailableModal.classList.contains('show') && !rewardClaimed) {
        openModal(rewardAvailableModal);
      }
    }

    closeProgressBtn.onclick = () => closeModal(progressModal);
    openRewardBtn.onclick = () => {
      closeModal(rewardAvailableModal);
      openModal(rewardLoadingModal);
      setTimeout(() => {
        closeModal(rewardLoadingModal);
        showRandomReward();
      }, 2000);
    };

    function showRandomReward() {
      const gifts = [
        'Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!',
        'Telegram Premium –Ω–∞ 1 –º–µ—Å—è—Ü!',
        '–ó–≤–µ–∑–¥—ã 250 —à—Ç—É–∫!',
        '–ó–≤–µ–∑–¥—ã 500 —à—Ç—É–∫!',
      ];
      const randomGift = gifts[Math.floor(Math.random() * gifts.length)];
      document.getElementById('rewardResultText').innerHTML = `–í–∞–º –≤—ã–ø–∞–ª:<br><strong>${randomGift}</strong>`;
      openModal(rewardResultModal);
      startConfetti();
    }

    closeRewardBtn.onclick = () => {
      rewardClaimed = true;
      closeModal(rewardResultModal);
      const pulse = document.getElementById('pulseDots');
  pulse.style.display = 'block';
       setTimeout(() => {
    pulse.style.display = 'none';
    alert('–ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! üéÅ');
  }, 2000);
};

    counter.addEventListener('click', () => {
      openModal(progressModal);
    });

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º Socket.IO
const socket = io('https://immense-fantasy-turret.glitch.me'); // –∞–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
const roomId = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe)
  ? window.Telegram.WebApp.initDataUnsafe.chat.id
  : 'default_room';
socket.emit('joinRoom', roomId);
socket.on('connect', () => {
  console.log('üß† –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ WebSocket-—Å–µ—Ä–≤–µ—Ä—É');
});

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   function sendTouch(x, y) {
  socket.emit('touch', { roomId, x, y });
}

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    let touchCooldown = false;
    let isModalOpen = false;
function handleTouch(x, y) {
   if (touchCooldown || isModalOpen) return;
  touchCooldown = true;
  setTimeout(() => (touchCooldown = false), 100); // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞—Å–∞–Ω–∏—è–º–∏
  myTouches++;
  updateCounter();
  createRandomEmoji(x, y);
  sendTouch(x, y);
  checkReward();
}

    // –õ–æ–≤–∏–º touchstart –∏ click (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
    let ignoreClick = false;

document.body.addEventListener('touchstart', e => {
  if (e.target === counter) return;
  const touch = e.touches[0];
  handleTouch(touch.clientX, touch.clientY);
  ignoreClick = true;
  setTimeout(() => {
    ignoreClick = false;
  }, 300); // 500 –º—Å ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–∫ –ø–æ—Å–ª–µ –∫–∞—Å–∞–Ω–∏—è
});

document.body.addEventListener('pointerdown', e => {
  if (e.target === counter) return;
  handleTouch(e.clientX, e.clientY);
});


    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –¥—Ä—É–≥–∞
   socket.on('friendTouch', ({ x, y }) => {
  friendTouches++;
  createRandomEmoji(x, y, 'üíó'); // –ø–æ–º–µ–Ω—è–ª createEmoji –Ω–∞ createRandomEmoji
 updateCounter();
  updateProgressModal();
  checkReward();
});

    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
    const confettiCanvas = document.createElement('canvas');
const ctx = confettiCanvas.getContext('2d');
document.body.appendChild(confettiCanvas);

let W = window.innerWidth;
let H = window.innerHeight;

confettiCanvas.width = W;
confettiCanvas.height = H;
confettiCanvas.style.position = 'fixed';
confettiCanvas.style.top = '0';
confettiCanvas.style.left = '0';
confettiCanvas.style.pointerEvents = 'none';
confettiCanvas.style.zIndex = '9999';

class Confetti {
  constructor() {
    this.x = Math.random() * W;
    this.y = Math.random() * H - H; // —Å—Ç–∞—Ä—Ç—É—é—Ç –Ω–∞–¥ —ç–∫—Ä–∞–Ω–æ–º
    this.size = 7 + Math.random() * 8;
    this.color = `hsl(${Math.floor(Math.random() * 360)}, 80%, 60%)`;
    this.speedY = 2 + Math.random() * 4;
    this.speedX = (Math.random() - 0.5) * 2;
    this.opacity = 1;

    this.rotationX = Math.random() * 360;
    this.rotationY = Math.random() * 360;
    this.rotationSpeedX = (Math.random() - 0.5) * 8;
    this.rotationSpeedY = (Math.random() - 0.5) * 8;

    this.blinkSpeed = 0.02 + Math.random() * 0.03;
    this.blinkPhase = Math.random() * Math.PI * 2;

    this.shape = Math.floor(Math.random() * 5);

    this.isBouncing = false;
    this.bounceSpeed = 0;

    this.bounceCount = 0; // —Å—á—ë—Ç—á–∏–∫ –æ—Ç—Å–∫–æ–∫–æ–≤
    this.maxBounces = 3; // —Å–∫–æ–ª—å–∫–æ –æ—Ç—Å–∫–æ–∫–æ–≤ –¥–æ fade-out –∏ —Å–±—Ä–æ—Å–∞
  }

  update() {
    this.y += this.speedY;
    this.x += this.speedX;

    this.rotationX += this.rotationSpeedX;
    this.rotationY += this.rotationSpeedY;

    this.opacity = 0.6 + 0.4 * Math.abs(Math.sin(this.blinkPhase));
    this.blinkPhase += this.blinkSpeed;

    if (this.y > H - this.size) {
      if (!this.isBouncing) {
        this.isBouncing = true;
        this.bounceSpeed = - (2 + Math.random() * 2);
        this.rotationSpeedX = (Math.random() - 0.5) * 20;
        this.rotationSpeedY = (Math.random() - 0.5) * 20;
      }
    }

    if (this.isBouncing) {
      this.y += this.bounceSpeed;
      this.bounceSpeed += 0.3;
      if (this.y >= H - this.size) {
        this.y = H - this.size;
        if (Math.abs(this.bounceSpeed) < 0.5) {
          this.isBouncing = false;
          this.bounceSpeed = 0;
          this.rotationSpeedX = (Math.random() - 0.5) * 8;
          this.rotationSpeedY = (Math.random() - 0.5) * 8;

          this.bounceCount++;

          // –ù–∞—á–∏–Ω–∞–µ–º –ø–ª–∞–≤–Ω—ã–π fade-out –ø–æ—Å–ª–µ maxBounces
          if (this.bounceCount >= this.maxBounces) {
            this.opacity -= 0.02; // —Å–∫–æ—Ä–æ—Å—Ç—å fade-out
            if (this.opacity <= 0) {
              this.reset();
            }
          }
        } else {
          this.bounceSpeed *= -0.6;
        }
      }
    }

    if (this.x > W) this.x = 0;
    if (this.x < 0) this.x = W;

    // –ï—Å–ª–∏ —É—à–ª–∞ —Å–ª–∏—à–∫–æ–º –Ω–∏–∑–∫–æ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
    if (this.y > H + this.size) {
      this.reset();
    }
  }

  reset() {
    // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —á–∞—Å—Ç–∏—Ü—É –Ω–∞–≤–µ—Ä—Ö, —Å–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    this.x = Math.random() * W;
    this.y = -this.size;
    this.opacity = 1;
    this.isBouncing = false;
    this.bounceSpeed = 0;
    this.bounceCount = 0;

    this.speedY = 2 + Math.random() * 4;
    this.speedX = (Math.random() - 0.5) * 2;
    this.rotationSpeedX = (Math.random() - 0.5) * 8;
    this.rotationSpeedY = (Math.random() - 0.5) * 8;
  }

  draw(ctx) {
    ctx.save();
    ctx.translate(this.x, this.y);

    const radX = this.rotationX * Math.PI / 180;
    const radY = this.rotationY * Math.PI / 180;

    const scaleY = Math.cos(radX);
    const skewX = Math.sin(radY) * 0.5;

    ctx.transform(1, 0, skewX, scaleY, 0, 0);

    ctx.shadowColor = this.color;
    ctx.shadowBlur = 8;

    ctx.globalAlpha = this.opacity;

    ctx.fillStyle = this.color;

    switch (this.shape) {
      case 0:
        ctx.fillRect(-this.size / 2, -this.size / 6, this.size, this.size / 3);
        break;
      case 1:
        ctx.beginPath();
        ctx.moveTo(0, -this.size / 2);
        ctx.lineTo(this.size / 2, this.size / 2);
        ctx.lineTo(-this.size / 2, this.size / 2);
        ctx.closePath();
        ctx.fill();
        break;
      case 2:
        ctx.fillRect(-this.size / 6, -this.size / 2, this.size / 3, this.size);
        break;
      case 3:
        this.drawStar(ctx, 0, 0, 5, this.size / 2, this.size / 4);
        break;
      case 4:
        ctx.beginPath();
        ctx.arc(0, 0, this.size / 2, 0, 2 * Math.PI);
        ctx.fill();
        break;
    }

    ctx.restore();
  }

  drawStar(ctx, cx, cy, spikes, outerRadius, innerRadius) {
    let rot = Math.PI / 2 * 3;
    let x = cx;
    let y = cy;
    let step = Math.PI / spikes;

    ctx.beginPath();
    ctx.moveTo(cx, cy - outerRadius);
    for (let i = 0; i < spikes; i++) {
      x = cx + Math.cos(rot) * outerRadius;
      y = cy + Math.sin(rot) * outerRadius;
      ctx.lineTo(x, y);
      rot += step;

      x = cx + Math.cos(rot) * innerRadius;
      y = cy + Math.sin(rot) * innerRadius;
      ctx.lineTo(x, y);
      rot += step;
    }
    ctx.lineTo(cx, cy - outerRadius);
    ctx.closePath();
    ctx.fill();
  }
}

let confettiPieces = [];
const CONFETTI_COUNT = 300;

function initConfetti() {
  confettiPieces = [];
  for (let i = 0; i < CONFETTI_COUNT; i++) {
    confettiPieces.push(new Confetti());
  }
}

function render() {
  ctx.clearRect(0, 0, W, H);
  confettiPieces.forEach(c => {
    c.update();
    c.draw(ctx);
  });
  requestAnimationFrame(render);
}

function startConfetti() {
  confettiCanvas.style.display = 'block';
  initConfetti();
  render();
}

window.addEventListener('resize', () => {
  W = window.innerWidth;
  H = window.innerHeight;
  confettiCanvas.width = W;
  confettiCanvas.height = H;
});

  </script>
</body>
</html>

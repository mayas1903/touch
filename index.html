<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Touch Me Softly</title>
<style>
  body {
    margin: 0; padding: 20px;
    background-image: url('https://i.postimg.cc/xdfHJk7x/042-FACF6-1710-454-B-84-F0-C2-D64859-AD77.jpg');
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    user-select: none;
    overflow: hidden;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* –°—á—ë—Ç—á–∏–∫ —Å–≤–µ—Ä—Ö—É */
  #counter {
    font-size: 18px;
    background: #ffe6f0;
    color: #d6336c;
    border-radius: 16px;
    padding: 12px 20px;
    margin-bottom: 10px;
    box-shadow: 0 6px 15px rgba(255, 182, 193, 0.6);
    cursor: pointer;
    position: relative;
    z-index: 10;
    width: fit-content;
  }
  #counter:hover {
    background: #ffccdd;
  }

  /* –ú–æ–¥–∞–ª–∫–∏ */
.modal {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -60%);
  background: #fefefe;
  border-radius: 20px;
  width: 270px;
  max-width: 90vw;
  padding: 20px 22px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
  font-size: 16px;
  color: #111;
  text-align: center;
  box-sizing: border-box;
  user-select: none;
  word-wrap: break-word;
  z-index: 1000;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
  backdrop-filter: blur(10px);
}

.modal.show {
  opacity: 1;
  pointer-events: auto;
  transform: translate(-50%, -50%);
}
.modal::before {
  content: "";
  position: fixed;
  top: 0; left: 0;
  width: 100vw; height: 100vh;
  background: rgba(0, 0, 0, 0.25);
  backdrop-filter: blur(2px);
  z-index: -1;
}

.modal h2, .modal h3 {
  font-weight: 600;
  margin-bottom: 12px;
}

.modal p {
  margin: 6px 0;
  line-height: 1.4;
  color: #333;
}

.modal button {
  background: #007aff;
  border-radius: 14px;
  padding: 12px 24px;
  font-weight: 600;
  box-shadow: 0 4px 10px rgba(0, 122, 255, 0.2);
}
.modal button:hover {
  background: #0060d8;
}

  /* –°–µ—Ä–¥–µ—á–∫–∏ */
 .heart {
  position: absolute;
  width: 70px;
  height: 70px;
  pointer-events: none;
  animation: floatUp 1.7s ease forwards;
  opacity: 1;
  z-index: 1000;
  font-size: 50px;       /* –¥–æ–±–∞–≤—å, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —É–≤–µ–ª–∏—á–∏—Ç—å —ç–º–æ–¥–∑–∏ */
  line-height: 70px;     /* —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—ã—Å–æ—Ç–µ */
  text-align: center;
  user-select: none;
}

  @keyframes floatUp {
    0% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translateY(-80px) scale(1.5);
      opacity: 0;
    }
  }
#rewardAvailableModal.show {
  animation: zoomInFromFar 0.6s ease forwards;
}

  /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ canvas */
  #confetti-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 5;
    display: none;
  }
</style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
<p id="description" style="
  font-size: 15px;
  color: #d6336c;
  margin-bottom: 10px;
  text-align: center;
  max-width: 700px;
  line-height: 1.4;
  position: relative;
  animation: glow 3s ease-in-out infinite alternate;
">
  –û—Ç–ø—Ä–∞–≤–ª—è–π –∫–∞—Å–∞–Ω–∏—è –∏ –ø–æ—Ü–µ–ª—É–π—á–∏–∫–∏ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥—Ä—É–≥—É –∏–ª–∏ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.<br>
  –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ –Ω–∞–±–µ—Ä—ë—Ç–µ <strong>1000</strong> –∫–∞—Å–∞–Ω–∏–π, –≤–∞—Å –∂–¥—ë—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ üíù
  <span class="sparkle" style="
    position: absolute;
    top: -8px;
    right: -12px;
    width: 10px;
    height: 10px;
    background: radial-gradient(circle, #ff90b3 20%, transparent 70%);
    border-radius: 50%;
    animation: sparkle 1.8s infinite ease-in-out;
    opacity: 0.8;
    pointer-events: none;
  "></span>

  <div id="counter" role="button" aria-label="–°—á—ë—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π">–¢—ã: 0 | –î—Ä—É–≥: 0</div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
  <div id="progressModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="progressTitle" aria-describedby="progressDesc">
    <h3 id="progressTitle">üíñ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
    <p>–¢—ã: <span id="progressMy">0</span></p>
    <p>–î—Ä—É–≥: <span id="progressFriend">0</span></p>
    <p>–í—Å–µ–≥–æ: <span id="progressTotal">0</span></p>
    <p>–î–æ –ø–æ–¥–∞—Ä–∫–∞ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="progressLeft">1000</span></p>
    <button id="closeProgressBtn">–û–∫</button>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥–∞—Ä–∫–∞ –ø—Ä–∏ 1000 -->
<!-- –ü–µ—Ä–≤–∞—è –º–æ–¥–∞–ª–∫–∞: –ü–æ–¥–∞—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–µ–Ω -->
<div id="rewardAvailableModal" class="modal">
  <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
  <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ <strong>1000 –∫–∞—Å–∞–Ω–∏–π</strong><br>–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–¥–∞—Ä–æ–∫!</p>
  <button id="openRewardBtn">–ü–æ–ª—É—á–∏—Ç—å</button>
</div>

<!-- –ê–Ω–∏–º–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
<div id="rewardLoadingModal" class="modal">
  <h2>üéÅ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫...</h2>
  <div style="margin-top: 20px; font-size: 24px;">‚è≥</div>
</div>

<!-- –§–∏–Ω–∞–ª—å–Ω–∞—è –º–æ–¥–∞–ª–∫–∞: –ü–æ–¥–∞—Ä–æ–∫ –ø–æ–ª—É—á–µ–Ω -->
<div id="rewardResultModal" class="modal">
  <h2>–£—Ä–∞! üéâ</h2>
  <p id="rewardResultText">–í–∞–º –≤—ã–ø–∞–ª Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!</p>
  <button id="closeRewardBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
</div>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–æ–≤
    let myTouches = 0;
    let friendTouches = 0; // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ 0, –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
    let totalTouches = 0;

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const counter = document.getElementById('counter');
const progressModal = document.getElementById('progressModal');

const rewardAvailableModal = document.getElementById('rewardAvailableModal');
const rewardLoadingModal = document.getElementById('rewardLoadingModal');
const rewardResultModal = document.getElementById('rewardResultModal');

const progressMy = document.getElementById('progressMy');
const progressFriend = document.getElementById('progressFriend');
const progressTotal = document.getElementById('progressTotal');
const progressLeft = document.getElementById('progressLeft');

const closeProgressBtn = document.getElementById('closeProgressBtn');
const openRewardBtn = document.getElementById('openRewardBtn');
const closeRewardBtn = document.getElementById('closeRewardBtn');

    const confettiCanvas = document.getElementById('confetti-canvas');
    const ctx = confettiCanvas.getContext('2d');
const socket = io('https://immense-fantasy-turret.glitch.me');

const roomId = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe)
  ? window.Telegram.WebApp.initDataUnsafe.chat.id
  : 'default_room'; 

// –°–æ–æ–±—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—É, –≤ –∫–∞–∫—É—é –∫–æ–º–Ω–∞—Ç—É –º—ã –∑–∞—Ö–æ–¥–∏–º
socket.emit('joinRoom', roomId);

socket.on('connect', () => {
  console.log('üß† –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ WebSocket-—Å–µ—Ä–≤–µ—Ä—É');
});

    // –†–∞–∑–º–µ—Ä canvas –ø–æ–¥ –æ–∫–Ω–æ
    function resizeCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ —á–∞—Å—Ç–∏—Ü—ã
  class ConfettiParticle {
  constructor() {
    this.x = Math.random() * confettiCanvas.width;
    this.y = Math.random() * confettiCanvas.height - confettiCanvas.height;
    this.size = (Math.random() * 6) + 4;
    this.speed = (Math.random() * 3) + 2;
    this.angle = Math.random() * 2 * Math.PI;
    this.spin = (Math.random() * 0.1) + 0.01;
    this.color = `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`;
    this.opacity = 1;
    this.fade = 0.005 + Math.random() * 0.005;
  }
  update() {
    this.y += this.speed;
    this.x += Math.sin(this.angle) * 2;
    this.angle += this.spin;
    this.opacity -= this.fade;
    if (this.y > confettiCanvas.height || this.opacity <= 0) {
      this.reset();
    }
  }
  reset() {
    this.x = Math.random() * confettiCanvas.width;
    this.y = -10;
    this.opacity = 1;
  }
  draw() {
    ctx.globalAlpha = this.opacity;
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.ellipse(this.x, this.y, this.size * 0.6, this.size, this.angle, 0, 2 * Math.PI);
    ctx.fill();
    ctx.globalAlpha = 1;
  }
  isVisible() {
    return this.opacity > 0;
  }
}
    let confettiParticles = [];

 function startConfetti() {
  confettiParticles = [];
  for (let i = 0; i < 400; i++) {
    confettiParticles.push(new ConfettiParticle());
  }
  confettiCanvas.classList.add('active');
  animateConfetti();
  setTimeout(() => {
    // –ù–µ –ø—Ä—è—á–µ–º —Å—Ä–∞–∑—É, –ø—É—Å—Ç—å –∞–Ω–∏–º–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è —Å–∞–º–∞
  }, 6000);
}

    function animateConfetti() {
  ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  confettiParticles.forEach(p => {
    p.update();
    p.draw();
  });
  // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ –≤–∏–¥–∏–º—ã–µ —á–∞—Å—Ç–∏—Ü—ã
  confettiParticles = confettiParticles.filter(p => p.isVisible());
  if (confettiParticles.length > 0) {
    requestAnimationFrame(animateConfetti);
  } else {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ—Ç –ª–∏ —á–∞—Å—Ç–∏—Ü —Å opacity > 0
    const stillVisible = confettiParticles.some(p => p.opacity > 0);
    if (stillVisible) {
      requestAnimationFrame(animateConfetti);
    } else {
      stopConfetti();
    }
  }
}
function stopConfetti() {
  confettiParticles = [];
  confettiCanvas.classList.remove('active');
  setTimeout(() => {
    ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
  }, 500); // –ø–æ–¥–æ–∂–¥–∞—Ç—å –ø–æ–∫–∞ opacity —Å—Ç–∞–Ω–µ—Ç 0
}

    // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–æ–∫
    function openModal(modal) {
      modal.classList.add('show');
    }
    function closeModal(modal) {
      modal.classList.remove('show');
    }

    // –ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–Ω–æ–ø–∫–∞–º
closeProgressBtn.onclick = () => closeModal(progressModal);
closeRewardBtn.onclick = () => {
  closeModal(rewardResultModal);
 setTimeout(() => {
    alert("–ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! üéÅ");
  }, 1000); // 1000 –º—Å = 1 —Å–µ–∫—É–Ω–¥–∞
};

let rewardClaimed = false;

function checkReward() {
  totalTouches = myTouches + friendTouches;
  if (totalTouches >= 10 && !rewardAvailableModal.classList.contains('show') && !rewardClaimed) {
    openModal(rewardAvailableModal);
  }
}

openRewardBtn.onclick = () => {
  closeModal(rewardAvailableModal);
  openModal(rewardLoadingModal);
  setTimeout(() => {
  createEmoji(window.innerWidth / 2, window.innerHeight / 2, 'üéä');
  createEmoji(window.innerWidth / 2 + 40, window.innerHeight / 2, 'ü•≥');
  createEmoji(window.innerWidth / 2 - 40, window.innerHeight / 2, 'üéâ');
}, 200);

  setTimeout(() => {
    closeModal(rewardLoadingModal);

    const gifts = [
      "Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!",
      "Telegram Premium –Ω–∞ 1 –º–µ—Å—è—Ü!",
      "–ó–≤–µ–∑–¥—ã 250 —à—Ç—É–∫!",
      "–ó–≤–µ–∑–¥—ã 500 —à—Ç—É–∫",
    ];
    const gift = gifts[Math.floor(Math.random() * gifts.length)];
   document.getElementById('rewardResultText').innerHTML = `–í–∞–º –≤—ã–ø–∞–ª–æ:<br><strong>${gift}</strong>`;
    openModal(rewardResultModal);

    startConfetti();
    rewardClaimed = true; // –ü–æ–¥–∞—Ä–æ–∫ –ø–æ–ª—É—á–µ–Ω, –±–æ–ª—å—à–µ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º
  }, 2000);
};


   window.addEventListener('click', (e) => {
  if (e.target === progressModal) closeModal(progressModal);
  // –£–±—Ä–∞–ª –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –ø–æ–¥–∞—Ä–∫–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
});

window.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal(progressModal);
    // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ—Ç–∏–≤–∞—Ü–∏—é –∏ –ø–æ–¥–∞—Ä–æ–∫ –ø–æ ESC
  }
});

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    function updateCounter() {
      counter.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏—è –¥—Ä—É–≥–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
socket.on('friendTouch', ({ x, y }) => {
  friendTouches++;
  createEmoji(x, y, 'üíó');  // –ó–¥–µ—Å—å —Å—Ç–∞–≤–∏–º —Å–º–∞–π–ª–∏–∫ –æ–≥–æ–Ω—å –¥–ª—è –¥—Ä—É–≥–∞
  updateCounter();
});
    
    // –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–∞–ª–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function updateProgressModal() {
      progressMy.textContent = myTouches;
      progressFriend.textContent = friendTouches;
      totalTouches = myTouches + friendTouches;
      progressTotal.textContent = totalTouches;
      progressLeft.textContent = Math.max(1000 - totalTouches, 0);
    }

    // –°–æ–∑–¥–∞—ë–º —Å–µ—Ä–¥–µ—á–∫–æ –ø–æ –∫–∞—Å–∞–Ω–∏—é
  function createEmoji(x, y, emoji = 'üíó') {
  const elem = document.createElement('div');
  elem.className = 'heart';
  elem.style.left = (x - 35) + 'px';
  elem.style.top = (y - 35) + 'px';
  elem.textContent = emoji;
  document.body.appendChild(elem);
  setTimeout(() => {
    elem.remove();
  }, 1200);
}
function animateCounter() {
  counter.style.transform = 'scale(1.2)';
  setTimeout(() => {
    counter.style.transform = 'scale(1)';
  }, 150);
}

document.body.addEventListener('click', (e) => {
  if (e.target === counter) return;
  if (
    progressModal.classList.contains('show') ||
    rewardAvailableModal.classList.contains('show') ||
    rewardLoadingModal.classList.contains('show') ||
    rewardResultModal.classList.contains('show')
  ) return;

  createEmoji(e.clientX, e.clientY, 'üíó');
  myTouches++;
  socket.emit('touch', { roomId, x: e.clientX, y: e.clientY });
  updateCounter();
  checkReward();

  if (navigator.vibrate) navigator.vibrate(50);
});

    // –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Å—á—ë—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    counter.addEventListener('click', () => {
      updateProgressModal();
      openModal(progressModal);
    });

  </script>
</body>
</html>

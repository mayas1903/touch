<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Touch Me Softly</title>
  <style>
    body {
      position: relative;
      margin: 0;
      padding: 20px;
      background-image: url('https://i.postimg.cc/xdfHJk7x/042-FACF6-1710-454-B-84-F0-C2-D64859-AD77.jpg');
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #counter {
      font-size: 18px;
      background: #ffe6f0;
      color: #d6336c;
      border-radius: 16px;
      padding: 12px 20px;
      margin-bottom: 10px;
      box-shadow: 0 6px 15px rgba(255, 182, 193, 0.6);
      cursor: pointer;
      position: relative;
      z-index: 10;
      width: fit-content;
    }
    #counter:hover {
      background: #ffccdd;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -60%);
      background: #fefefe;
      border-radius: 20px;
      width: 270px;
      max-width: 90vw;
      padding: 20px 22px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      font-size: 16px;
      color: #111;
      text-align: center;
      box-sizing: border-box;
      user-select: none;
      word-wrap: break-word;
      z-index: 11000 !important;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
      backdrop-filter: blur(10px);
    }

    .modal.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%);
    }

    .modal h2, .modal h3 {
      font-weight: 600;
      margin-bottom: 12px;
    }

    .modal p {
      margin: 6px 0;
      line-height: 1.4;
      color: #333;
    }

    .modal button {
      margin-top: 18px;
      background: #007aff;
      border: none;
      color: white;
      padding: 10px 22px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.25s ease;
    }

    .modal button:hover {
      background: #005ecb;
    }

    .heart {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      animation: floatUp 1.7s ease forwards;
      opacity: 1;
      z-index: 1000;
      font-size: 35px;
      line-height: 70px;
      text-align: center;
      user-select: none;
    }

    @keyframes floatUp {
  0% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  40% {
    transform: translateY(-30px) scale(1.3);
    opacity: 1;
  }
  100% {
    transform: translateY(-80px) scale(1.7);
    opacity: 0;
  }
}

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #rewardLoadingModal div {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    #rewardAvailableModal.show {
      animation: zoomInFromFar 0.6s ease forwards;
    }

    #spinner {
      animation: spin 2s linear infinite;
    }

    #confetti-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 10000;
      display: none;
    }

    @keyframes sparkle {
      0%, 100% {opacity: 0.8;}
      50% {opacity: 0.4;}
    }

    @keyframes glow {
      0% { text-shadow: 0 0 10px #d6336c;}
      100% { text-shadow: 0 0 20px #ff90b3;}
    }
  </style>
</head>
<body>

  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∫–∏ -->
<button id="noteButton" style="margin-top: 10px; padding: 10px 20px; border-radius: 12px; background: #ff69b4; color: white; border: none; font-size: 16px; cursor: pointer;">üíå –ù–∞–ø–∏—Å–∞—Ç—å –∑–∞–ø–∏—Å–∫—É</button>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–ø–∏—Å–∏ -->
<div id="noteModal" class="modal">
  <h3>–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å–∫—É</h3>
  <textarea id="noteText" maxlength="140" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø–∏—Å–∫—É..." style="width: 100%; border-radius: 8px; padding: 8px;"></textarea>
  <p style="margin-top: 10px;">–ü–æ–∫–∞–∑–∞—Ç—å, –∫–æ–≥–¥–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:</p>
  <input id="noteThreshold" type="number" min="1" max="10000" value="50" style="width: 100%; padding: 8px; border-radius: 8px;" />
  <button id="saveNoteBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞ –∑–∞–ø–∏—Å–∫–∏ -->
<div id="noteRevealModal" class="modal">
  <h3>üì© –°–æ–æ–±—â–µ–Ω–∏–µ</h3>
  <p id="revealedNoteText"></p>
  <button onclick="closeModal(noteRevealModal)">–û–∫</button>
</div>

  <canvas id="confetti-canvas"></canvas>
  <p id="description" style="
    font-size: 15px;
    color: #d6336c;
    margin-bottom: 10px;
    text-align: center;
    max-width: 700px;
    line-height: 1.4;
    position: relative;
    animation: glow 3s ease-in-out infinite alternate;
  ">
    –û—Ç–ø—Ä–∞–≤–ª—è–π –∫–∞—Å–∞–Ω–∏—è –∏ –ø–æ—Ü–µ–ª—É–π—á–∏–∫–∏ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥—Ä—É–≥—É –∏–ª–∏ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.<br>
    –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ –Ω–∞–±–µ—Ä—ë—Ç–µ <strong>1000</strong> –∫–∞—Å–∞–Ω–∏–π, –≤–∞—Å –∂–¥—ë—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ üíù
    <span class="sparkle" style="
      position: absolute;
      top: -8px;
      right: -12px;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #ff90b3 20%, transparent 70%);
      border-radius: 50%;
      animation: sparkle 1.8s infinite ease-in-out;
      opacity: 0.8;
      pointer-events: none;
    "></span>
  </p>
  
<div id="pulseDots" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000;">
  <svg width="80" height="24" viewBox="0 0 80 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="10" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" repeatCount="indefinite"/>
    </circle>
    <circle cx="40" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.2s" repeatCount="indefinite"/>
    </circle>
    <circle cx="70" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.4s" repeatCount="indefinite"/>
    </circle>
  </svg>
</div>
  
  <div id="emojiSelector" style="margin-top: 12px; margin-bottom: 20px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
  <span class="emojiChoice" style="cursor: pointer; font-size: 30px;">‚ù§Ô∏è</span>
  <span class="emojiChoice" style="cursor: pointer; font-size: 30px;">üå∏</span>
  <span class="emojiChoice" style="cursor: pointer; font-size: 30px;">‚ú®</span>
  <span class="emojiChoice" style="cursor: pointer; font-size: 30px;">üí©</span>
  <span class="emojiChoice" style="cursor: pointer; font-size: 30px;">üíã</span>
  <span class="emojiChoice" style="cursor: pointer; font-size: 30px;">üî•</span>
</div>
  
  <div id="counter" role="button" aria-label="–°—á—ë—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π">–¢—ã: 0 | –î—Ä—É–≥: 0</div>
  
  <div id="progressModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="progressTitle" aria-describedby="progressDesc">
    <h3 id="progressTitle">üíñ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
    <p>–¢—ã: <span id="progressMy">0</span></p>
    <p>–î—Ä—É–≥: <span id="progressFriend">0</span></p>
    <p>–í—Å–µ–≥–æ: <span id="progressTotal">0</span></p>
    <p>–î–æ –ø–æ–¥–∞—Ä–∫–∞ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="progressLeft">1000</span></p>
    <button id="closeProgressBtn">–û–∫</button>
  </div>

  <div id="rewardAvailableModal" class="modal">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
    <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ <strong>1000 –∫–∞—Å–∞–Ω–∏–π</strong><br>–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–¥–∞—Ä–æ–∫!</p>
    <button id="openRewardBtn">–ü–æ–ª—É—á–∏—Ç—å</button>
  </div>

  <div id="rewardLoadingModal" class="modal">
    <h2>üéÅ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫...</h2>
    <div style="margin-top: 20px; font-size: 24px;">‚è≥</div>
  </div>

  <div id="rewardResultModal" class="modal">
    <h2>–£—Ä–∞! üéâ</h2>
    <p id="rewardResultText">–í–∞–º –≤—ã–ø–∞–ª Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!</p>
    <button id="closeRewardBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    let myTouches = 0;
    let selectedEmoji = '‚ù§Ô∏è';
    let friendTouches = 0;
    let totalTouches = 0;

    const counter = document.getElementById('counter');
    const progressModal = document.getElementById('progressModal');
    const rewardAvailableModal = document.getElementById('rewardAvailableModal');
    const rewardLoadingModal = document.getElementById('rewardLoadingModal');
    const rewardResultModal = document.getElementById('rewardResultModal');

    const progressMy = document.getElementById('progressMy');
    const progressFriend = document.getElementById('progressFriend');
    const progressTotal = document.getElementById('progressTotal');
    const progressLeft = document.getElementById('progressLeft');

    const closeProgressBtn = document.getElementById('closeProgressBtn');
    const openRewardBtn = document.getElementById('openRewardBtn');
    const closeRewardBtn = document.getElementById('closeRewardBtn');

    let lastMyTouches = 0;
    let lastFriendTouches = 0;
    let rewardClaimed = false;

    let savedNote = null;
let noteThreshold = 0;
let noteShown = false;
    const noteModal = document.getElementById('noteModal');
const noteButton = document.getElementById('noteButton');
const saveNoteBtn = document.getElementById('saveNoteBtn');
const noteText = document.getElementById('noteText');
const noteThresholdInput = document.getElementById('noteThreshold');
const noteRevealModal = document.getElementById('noteRevealModal');
const revealedNoteText = document.getElementById('revealedNoteText');

// –û—Ç–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –∑–∞–ø–∏—Å–∫–∏
noteButton.onclick = () => {
  openModal(noteModal);
};

// –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞–ø–∏—Å–∫—É –∏ –ø–æ—Ä–æ–≥
saveNoteBtn.onclick = () => {
  const text = noteText.value.trim();
  const threshold = parseInt(noteThresholdInput.value, 10);
  if (text && threshold > 0) {
    savedNote = text;
    noteThreshold = threshold;
    closeModal(noteModal);
    alert(`‚úâÔ∏è –ó–∞–ø–∏—Å–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –ü–æ–∫–∞–∂–µ—Ç—Å—è –ø—Ä–∏ ${threshold} –∫–∞—Å–∞–Ω–∏—è—Ö.`);
  }
};

    function animateNumber(element, start, end, duration = 300) {
      const startTime = performance.now();

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentValue = Math.floor(start + (end - start) * progress);
        element.textContent = currentValue;
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      requestAnimationFrame(update);
    }
const emojis = ['‚ù§Ô∏è', 'üå∏', '‚ú®', 'üí©', 'üíã', 'üî•'];

    function createRandomEmoji(x, y, emoji = selectedEmoji) {
  const span = document.createElement('span');
  span.className = 'heart';
  span.textContent = emoji;
  span.style.left = (x - 20) + 'px';
  span.style.top = (y - 20) + 'px';
  document.body.appendChild(span);
  setTimeout(() => {
    span.remove();
  }, 1700);
}

    function updateCounter() {
      counter.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
    }

    function updateProgressModal() {
  progressMy.textContent = myTouches;
  progressFriend.textContent = friendTouches;
  totalTouches = myTouches + friendTouches;
  progressTotal.textContent = totalTouches;
  progressLeft.textContent = Math.max(1000 - totalTouches, 0);
}
    function openModal(modal) {
      isModalOpen = true;
      modal.classList.add('show');
    }

    function closeModal(modal) {
       isModalOpen = false;
      modal.classList.remove('show');
    }

    function checkReward() {
      totalTouches = myTouches + friendTouches;
      if (totalTouches >= 10 && !rewardAvailableModal.classList.contains('show') && !rewardClaimed) {
        openModal(rewardAvailableModal);
      }
      if (savedNote && totalTouches >= noteThreshold && !noteShown) {
    revealedNoteText.textContent = savedNote;
    openModal(noteRevealModal);
    noteShown = true;
  }
  }
      
    closeProgressBtn.onclick = () => closeModal(progressModal);
    openRewardBtn.onclick = () => {
      closeModal(rewardAvailableModal);
      openModal(rewardLoadingModal);
      setTimeout(() => {
        closeModal(rewardLoadingModal);
        showRandomReward();
      }, 2000);
    };

    function showRandomReward() {
      const gifts = [
        'Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!',
        'Telegram Premium –Ω–∞ 1 –º–µ—Å—è—Ü!',
        '–ó–≤–µ–∑–¥—ã 250 —à—Ç—É–∫!',
        '–ó–≤–µ–∑–¥—ã 500 —à—Ç—É–∫!',
      ];
      const randomGift = gifts[Math.floor(Math.random() * gifts.length)];
      document.getElementById('rewardResultText').innerHTML = `–í–∞–º –≤—ã–ø–∞–ª:<br><strong>${randomGift}</strong>`;
      openModal(rewardResultModal);
      startConfetti();
    }

    closeRewardBtn.onclick = () => {
      rewardClaimed = true;
      closeModal(rewardResultModal);
      const pulse = document.getElementById('pulseDots');
  pulse.style.display = 'block';
       setTimeout(() => {
    pulse.style.display = 'none';
    alert('–ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! üéÅ');
  }, 2000);
};

    counter.addEventListener('click', () => {
      openModal(progressModal);
    });

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º Socket.IO
const socket = io('https://immense-fantasy-turret.glitch.me'); // –∞–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
const roomId = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe)
  ? window.Telegram.WebApp.initDataUnsafe.chat.id
  : 'default_room';
socket.emit('joinRoom', roomId);
socket.on('connect', () => {
  // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏
document.querySelectorAll('.emojiChoice').forEach(el => {
  el.addEventListener('click', () => {
    selectedEmoji = el.textContent;
    document.querySelectorAll('.emojiChoice').forEach(e => e.style.opacity = '0.5');
    el.style.opacity = '1';
  });
});
// –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤—ã–¥–µ–ª–∏–º –ø–µ—Ä–≤—ã–π
document.querySelectorAll('.emojiChoice')[0].style.opacity = '1';
  console.log('üß† –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ WebSocket-—Å–µ—Ä–≤–µ—Ä—É');
});

    // –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
   function sendTouch(x, y) {
  socket.emit('touch', { roomId, x, y, emoji: selectedEmoji });
}

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
    let touchCooldown = false;
    let isModalOpen = false;
    
function handleTouch(x, y, target = null) {
  if (touchCooldown || isModalOpen) return;
  if (target && (target.closest('#emojiSelector') || target.classList.contains('emojiChoice'))) return;
  touchCooldown = true;
  setTimeout(() => (touchCooldown = false), 100);
  myTouches++;
  updateCounter();
  createRandomEmoji(x, y, selectedEmoji); // ‚úÖ –ø–µ—Ä–µ–¥–∞—ë–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —ç–º–æ–¥–∑–∏
  sendTouch(x, y);
  checkReward();
}

    // –õ–æ–≤–∏–º touchstart –∏ click (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
    let ignoreClick = false;

document.body.addEventListener('touchstart', e => {
  const touch = e.touches[0];
  handleTouch(touch.clientX, touch.clientY, e.target);
  ignoreClick = true;
  setTimeout(() => {
    ignoreClick = false;
  }, 300);
});

document.body.addEventListener('pointerdown', e => {
  const target = e.target;
  if (target.closest('#counter') || target.closest('#emojiSelector')) return;
  handleTouch(e.clientX, e.clientY, target);
});

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ—Ç –¥—Ä—É–≥–∞
   socket.on('friendTouch', ({ x, y, emoji }) => {
  friendTouches++;
  createRandomEmoji(x, y, emoji );
  updateCounter();
  updateProgressModal();
  checkReward();
});

    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
   const confettiCanvas = document.createElement('canvas');
const ctx = confettiCanvas.getContext('2d');
document.body.appendChild(confettiCanvas);

let W = window.innerWidth;
let H = window.innerHeight;

confettiCanvas.width = W;
confettiCanvas.height = H;
confettiCanvas.style.position = 'fixed';
confettiCanvas.style.top = '0';
confettiCanvas.style.left = '0';
confettiCanvas.style.pointerEvents = 'none';
confettiCanvas.style.zIndex = '9999';

class Confetti {
  constructor() {
    this.x = Math.random() * W;
    this.y = Math.random() * H - H;
    this.size = 15; // —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    this.speedY = 3 + Math.random() * 1; // –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è
    this.speedX = (Math.random() - 0.5) * 1; // –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑–±—Ä–æ—Å –ø–æ X
    this.opacity = 1;

    this.rotation = Math.random() * 360;
    this.rotationSpeed = (Math.random() - 0.5) * 5;

    this.colorHue = Math.floor(Math.random() * 360);
  }

  update() {
    this.y += this.speedY;
    this.x += this.speedX;
    this.rotation += this.rotationSpeed;

    if (this.x > W) this.x = 0;
    if (this.x < 0) this.x = W;

    if (this.y > H + this.size) {
      this.reset();
    }
  }

  reset() {
    this.x = Math.random() * W;
    this.y = -this.size;
    this.opacity = 1;
    this.size = 15;
    this.speedY = 3 + Math.random();
    this.speedX = (Math.random() - 0.5) * 1;
    this.rotation = Math.random() * 360;
    this.rotationSpeed = (Math.random() - 0.5) * 5;
    this.colorHue = Math.floor(Math.random() * 360);
  }

  draw(ctx) {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation * Math.PI / 180);

    const grad = ctx.createLinearGradient(-this.size/2, -this.size/2, this.size/2, this.size/2);
    grad.addColorStop(0, `hsl(${this.colorHue}, 90%, 75%)`);
    grad.addColorStop(0.5, `hsl(${this.colorHue}, 100%, 50%)`);
    grad.addColorStop(1, `hsl(${this.colorHue}, 90%, 75%)`);

    ctx.fillStyle = grad;
    ctx.shadowColor = `hsl(${this.colorHue}, 100%, 70%)`;
    ctx.shadowBlur = 6;

    ctx.globalAlpha = this.opacity;

    // –¢–æ–ª—å–∫–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏, —á—É—Ç—å —Ç–æ–Ω—å—à–µ
    ctx.fillRect(-this.size / 2, -this.size / 6, this.size, this.size / 3);

    ctx.restore();
  }
}

let confettiPieces = [];
const CONFETTI_COUNT = 300;

function initConfetti() {
  confettiPieces = [];
  for (let i = 0; i < CONFETTI_COUNT; i++) {
    confettiPieces.push(new Confetti());
  }
}

function render() {
  ctx.clearRect(0, 0, W, H);
  confettiPieces.forEach(c => {
    c.update();
    c.draw(ctx);
  });
  requestAnimationFrame(render);
}

function startConfetti() {
  confettiCanvas.style.display = 'block';
  confettiCanvas.style.opacity = '1';
  initConfetti();
  render();

  // –ù–∞—á–∏–Ω–∞–µ–º –ø–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
  let fadeDuration = 4000;
  let startTime = null;

  function fadeOut(timestamp) {
    if (!startTime) startTime = timestamp;
    let elapsed = timestamp - startTime;
    let progress = Math.min(elapsed / fadeDuration, 1);
    confettiCanvas.style.opacity = 1 - progress;

    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø–ª–∞–≤–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º opacity
    confettiPieces.forEach(c => {
      c.opacity = 1 - progress;
    });

    if (progress < 1) {
      requestAnimationFrame(fadeOut);
    } else {
      confettiCanvas.style.display = 'none';
      confettiPieces = [];
    }
  }

  requestAnimationFrame(fadeOut);
}


window.addEventListener('resize', () => {
  W = window.innerWidth;
  H = window.innerHeight;
  confettiCanvas.width = W;
  confettiCanvas.height = H;
});


  </script>
</body>
</html>

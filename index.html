<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Touch Me Softly</title>
<style>
  body {
    margin: 0; padding: 20px;
    background: #fff0f6;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    user-select: none;
    overflow: hidden;
    height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  /* –°—á—ë—Ç—á–∏–∫ —Å–≤–µ—Ä—Ö—É */
  #counter {
    font-size: 18px;
    background: #ffe6f0;
    color: #d6336c;
    border-radius: 16px;
    padding: 12px 20px;
    margin-bottom: 10px;
    box-shadow: 0 6px 15px rgba(255, 182, 193, 0.6);
    cursor: pointer;
    position: relative;
    z-index: 10;
    width: fit-content;
  }
  #counter:hover {
    background: #ffccdd;
  }

  /* –ú–æ–¥–∞–ª–∫–∏ */
  .modal {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -60%);
    background: #fff;
    border-radius: 20px;
    width: 270px;
    max-width: 90vw;
    padding: 18px 20px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    font-size: 15px;
    color: #000;
    text-align: center;
    box-sizing: border-box;
    user-select: none;
    word-wrap: break-word;
    z-index: 1000;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
  }
  .modal.show {
  opacity: 1;
  pointer-events: auto;
  transform: translate(-50%, -50%);
}
  .modal button {
    margin-top: 15px;
    background: #d6336c;
    border: none;
    color: white;
    padding: 10px 20px;
    border-radius: 12px;
    font-size: 15px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  .modal button:hover {
    background: #b02753;
  }

  /* –°–µ—Ä–¥–µ—á–∫–∏ */
 .heart {
  position: absolute;
  width: 70px;
  height: 70px;
  pointer-events: none;
  animation: floatUp 1.7s ease forwards;
  opacity: 1;
  z-index: 1000;
  font-size: 50px;       /* –¥–æ–±–∞–≤—å, –µ—Å–ª–∏ —Ö–æ—á–µ—à—å —É–≤–µ–ª–∏—á–∏—Ç—å —ç–º–æ–¥–∑–∏ */
  line-height: 70px;     /* —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—ã—Å–æ—Ç–µ */
  text-align: center;
  user-select: none;
}

  @keyframes floatUp {
    0% {
      transform: translateY(0) scale(1);
      opacity: 1;
    }
    100% {
      transform: translateY(-80px) scale(1.5);
      opacity: 0;
    }
  }

  /* –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ canvas */
  #confetti-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100vw;
    height: 100vh;
    pointer-events: none;
    z-index: 2000;
    display: none;
  }
</style>
</head>
<body>
<p id="description" style="
  font-size: 15px;
  color: #d6336c;
  margin-bottom: 10px;
  text-align: center;
  max-width: 300px;
  line-height: 1.4;
  position: relative;
  animation: glow 3s ease-in-out infinite alternate;
">
  –û—Ç–ø—Ä–∞–≤–ª—è–π –∫–∞—Å–∞–Ω–∏—è –∏ –ø–æ—Ü–µ–ª—É–π—á–∏–∫–∏ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥—Ä—É–≥—É –∏–ª–∏ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.<br>
  –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ –Ω–∞–±–µ—Ä—ë—Ç–µ <strong>1000</strong> –∫–∞—Å–∞–Ω–∏–π, –≤–∞—Å –∂–¥—ë—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ üíù
  <span class="sparkle" style="
    position: absolute;
    top: -8px;
    right: -12px;
    width: 10px;
    height: 10px;
    background: radial-gradient(circle, #ff90b3 20%, transparent 70%);
    border-radius: 50%;
    animation: sparkle 1.8s infinite ease-in-out;
    opacity: 0.8;
    pointer-events: none;
  "></span>
</p>


  <div id="counter" role="button" aria-label="–°—á—ë—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π">–¢—ã: 0 | –î—Ä—É–≥: 0</div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
  <div id="progressModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="progressTitle" aria-describedby="progressDesc">
    <h3 id="progressTitle">üíñ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
    <p>–¢—ã: <span id="progressMy">0</span></p>
    <p>–î—Ä—É–≥: <span id="progressFriend">0</span></p>
    <p>–í—Å–µ–≥–æ: <span id="progressTotal">0</span></p>
    <p>–î–æ –ø–æ–¥–∞—Ä–∫–∞ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="progressLeft">1000</span></p>
    <button id="closeProgressBtn">–û–∫</button>
  </div>

  <!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–¥–∞—Ä–∫–∞ –ø—Ä–∏ 1000 -->
<div id="giftModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="giftTitle" aria-describedby="giftDesc">
  <div class="gift-animation">
    <div class="gift-box">
      <div class="lid"></div>
      <div class="box"></div>
      <div class="ribbon"></div>
    </div>
  </div>
  <h2 id="giftTitle">üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
  <p id="giftDesc">–í—ã —Å–æ–±—Ä–∞–ª–∏ <strong>1000 –∫–∞—Å–∞–Ω–∏–π üíñ</strong></p>
  <p>üéÅ –ü–æ–¥–∞—Ä–æ–∫: Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞</p>
  <button id="claimGiftBtn">–ü–æ–ª—É—á–∏—Ç—å</button>
  <div id="loadingIndicator" style="display:none; margin-top: 15px;">
  üîÑ –ê–∫—Ç–∏–≤–∞—Ü–∏—è...
</div>
  <button id="closeGiftBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
</div>

  <canvas id="confetti-canvas"></canvas>
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å—á—ë—Ç—á–∏–∫–æ–≤
    let myTouches = 0;
    let friendTouches = 0; // –ü–æ–∫–∞ –ø—Ä–æ—Å—Ç–æ 0, –º–æ–∂–Ω–æ –ø–æ—Ç–æ–º —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å
    let totalTouches = 0;

    // –≠–ª–µ–º–µ–Ω—Ç—ã
    const counter = document.getElementById('counter');
    const progressModal = document.getElementById('progressModal');
    const giftModal = document.getElementById('giftModal');

    const progressMy = document.getElementById('progressMy');
    const progressFriend = document.getElementById('progressFriend');
    const progressTotal = document.getElementById('progressTotal');
    const progressLeft = document.getElementById('progressLeft');

    const closeProgressBtn = document.getElementById('closeProgressBtn');
    const closeGiftBtn = document.getElementById('closeGiftBtn');

    const confettiCanvas = document.getElementById('confetti-canvas');
    const ctx = confettiCanvas.getContext('2d');
const socket = io('https://immense-fantasy-turret.glitch.me');

const roomId = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe)
  ? window.Telegram.WebApp.initDataUnsafe.chat.id
  : 'default_room'; 

// –°–æ–æ–±—â–∞–µ–º —Å–µ—Ä–≤–µ—Ä—É, –≤ –∫–∞–∫—É—é –∫–æ–º–Ω–∞—Ç—É –º—ã –∑–∞—Ö–æ–¥–∏–º
socket.emit('joinRoom', roomId);

socket.on('connect', () => {
  console.log('üß† –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ WebSocket-—Å–µ—Ä–≤–µ—Ä—É');
});

    // –†–∞–∑–º–µ—Ä canvas –ø–æ–¥ –æ–∫–Ω–æ
    function resizeCanvas() {
      confettiCanvas.width = window.innerWidth;
      confettiCanvas.height = window.innerHeight;
    }
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);

    // –ö–æ–Ω—Ñ–µ—Ç—Ç–∏ —á–∞—Å—Ç–∏—Ü—ã
    class ConfettiParticle {
      constructor() {
        this.x = Math.random() * confettiCanvas.width;
        this.y = Math.random() * confettiCanvas.height - confettiCanvas.height;
        this.size = (Math.random() * 6) + 4;
        this.speed = (Math.random() * 3) + 2;
        this.angle = Math.random() * 2 * Math.PI;
        this.spin = (Math.random() * 0.1) + 0.01;
        this.color = `hsl(${Math.floor(Math.random() * 360)}, 70%, 60%)`;
      }
      update() {
        this.y += this.speed;
        this.x += Math.sin(this.angle) * 2;
        this.angle += this.spin;
        if (this.y > confettiCanvas.height) {
          this.y = -10;
          this.x = Math.random() * confettiCanvas.width;
        }
      }
      draw() {
        ctx.fillStyle = this.color;
        ctx.beginPath();
        ctx.ellipse(this.x, this.y, this.size * 0.6, this.size, this.angle, 0, 2 * Math.PI);
        ctx.fill();
      }
    }

    let confettiParticles = [];

    function startConfetti() {
      confettiParticles = [];
      for (let i = 0; i < 150; i++) {
        confettiParticles.push(new ConfettiParticle());
      }
      confettiCanvas.style.display = 'block';
      animateConfetti();
      setTimeout(stopConfetti, 4000);
    }

    function animateConfetti() {
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
      confettiParticles.forEach(p => {
        p.update();
        p.draw();
      });
      if (confettiParticles.length > 0) {
        requestAnimationFrame(animateConfetti);
      }
    }

    function stopConfetti() {
      confettiParticles = [];
      confettiCanvas.style.display = 'none';
      ctx.clearRect(0, 0, confettiCanvas.width, confettiCanvas.height);
    }

    // –§—É–Ω–∫—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è/–∑–∞–∫—Ä—ã—Ç–∏—è –º–æ–¥–∞–ª–æ–∫
    function openModal(modal) {
      modal.classList.add('show');
    }
    function closeModal(modal) {
      modal.classList.remove('show');
    }

    // –ó–∞–∫—Ä—ã—Ç–∏—è –ø–æ –∫–Ω–æ–ø–∫–∞–º
    closeProgressBtn.onclick = () => closeModal(progressModal);
    closeGiftBtn.onclick = () => closeModal(giftModal);

   window.addEventListener('click', (e) => {
  if (e.target === progressModal) closeModal(progressModal);
  // –£–±—Ä–∞–ª –∑–∞–∫—Ä—ã—Ç–∏–µ –º–æ—Ç–∏–≤–∞—Ü–∏–∏ –∏ –ø–æ–¥–∞—Ä–∫–∞ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ
});

window.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeModal(progressModal);
    // –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ–º –º–æ—Ç–∏–≤–∞—Ü–∏—é –∏ –ø–æ–¥–∞—Ä–æ–∫ –ø–æ ESC
  }
});

    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á—ë—Ç—á–∏–∫–∞ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
    function updateCounter() {
      counter.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–∞—Å–∞–Ω–∏—è –¥—Ä—É–≥–∞ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
socket.on('friendTouch', ({ x, y }) => {
  friendTouches++;
  createEmoji(x, y, 'üíã');  // –ó–¥–µ—Å—å —Å—Ç–∞–≤–∏–º —Å–º–∞–π–ª–∏–∫ –æ–≥–æ–Ω—å –¥–ª—è –¥—Ä—É–≥–∞
  updateCounter();
});

socket.on('showGift', () => {
  openModal(giftModal);
  startConfetti();
});
    
    // –û–±–Ω–æ–≤–∏—Ç—å –º–æ–¥–∞–ª–∫—É –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
    function updateProgressModal() {
      progressMy.textContent = myTouches;
      progressFriend.textContent = friendTouches;
      totalTouches = myTouches + friendTouches;
      progressTotal.textContent = totalTouches;
      progressLeft.textContent = Math.max(1000 - totalTouches, 0);
    }

    // –í—Å–ø–ª—ã–≤–∞—à–∫–∞ –ø–æ–¥–∞—Ä–∫–∞ –ø—Ä–∏ 1000
    function showGift() {
      openModal(giftModal);
      startConfetti();
    }

    // –°–æ–∑–¥–∞—ë–º —Å–µ—Ä–¥–µ—á–∫–æ –ø–æ –∫–∞—Å–∞–Ω–∏—é
  function createEmoji(x, y, emoji = 'üíó') {
  const elem = document.createElement('div');
  elem.className = 'heart';
  elem.style.left = (x - 35) + 'px';
  elem.style.top = (y - 35) + 'px';
  elem.textContent = emoji;
  document.body.appendChild(elem);
  setTimeout(() => {
    elem.remove();
  }, 1200);
}

    // –õ–æ–≥–∏–∫–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –ø–æ —ç–∫—Ä–∞–Ω—É (–∫—Ä–æ–º–µ —Å—á—ë—Ç—á–∏–∫–∞)
   document.body.addEventListener('click', (e) => {
  if (e.target === counter) return;
       if (
    progressModal.classList.contains('show') ||
    giftModal.classList.contains('show')
  ) {
    return; 
  }
  createEmoji(e.clientX, e.clientY, 'üíó'); // –¢–≤–æ–π —Å–º–∞–π–ª–∏–∫ ‚Äî —Å–µ—Ä–¥–µ—á–∫–æ
  myTouches++;
  socket.emit('touch', { roomId, x: e.clientX, y: e.clientY });
  updateCounter();
  const total = myTouches + friendTouches;
  if (total === 1000) {
    socket.emit('showGift', { roomId });
  }
});
    // –ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ —Å—á—ë—Ç—á–∏–∫ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å
    counter.addEventListener('click', () => {
      updateProgressModal();
      openModal(progressModal);
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateCounter();
    const claimGiftBtn = document.getElementById('claimGiftBtn');
claimGiftBtn.onclick = () => {
  const loading = document.getElementById('loadingIndicator');
  claimGiftBtn.disabled = true; // –ë–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É, —á—Ç–æ–±—ã –Ω–µ —Å–ø–∞–º–∏–ª–∏
  loading.style.display = 'flex'; // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä

  setTimeout(() => {
    loading.style.display = 'none'; // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
    claimGiftBtn.disabled = false; // –†–∞–∑–±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫—É
    alert('–ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –°–ø–∞—Å–∏–±–æ, —á—Ç–æ –∏–≥—Ä–∞–µ—Ç–µ üòä');
    closeModal(giftModal);
  }, 2000); // 2 —Å–µ–∫—É–Ω–¥—ã –∏–º–∏—Ç–∞—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏
};

  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Touch Me Softly</title>
  <style>
    body {
      position: relative;
      margin: 0;
      padding: 20px;
      background-image: url('https://i.postimg.cc/xdfHJk7x/042-FACF6-1710-454-B-84-F0-C2-D64859-AD77.jpg');
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    #counter {
      font-size: 18px;
      background: #ffe6f0;
      color: #d6336c;
      border-radius: 16px;
      padding: 12px 20px;
      margin-bottom: 10px;
      box-shadow: 0 6px 15px rgba(255, 182, 193, 0.6);
      cursor: pointer;
      position: relative;
      z-index: 10;
      width: fit-content;
    }
    #counter:hover {
      background: #ffccdd;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -60%);
      background: #fefefe;
      border-radius: 20px;
      width: 270px;
      max-width: 90vw;
      padding: 20px 22px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      font-size: 16px;
      color: #111;
      text-align: center;
      box-sizing: border-box;
      user-select: none;
      word-wrap: break-word;
      z-index: 11000 !important;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
      backdrop-filter: blur(10px);
    }

    .modal.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%);
    }

    .modal h2, .modal h3 {
      font-weight: 600;
      margin-bottom: 12px;
    }

    .modal p {
      margin: 6px 0;
      line-height: 1.4;
      color: #333;
    }

    .modal button {
      margin-top: 18px;
      background: #007aff;
      border: none;
      color: white;
      padding: 10px 22px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.25s ease;
    }

    .modal button:hover {
      background: #005ecb;
    }

    .heart {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      animation: floatUp 1.7s ease forwards;
      opacity: 1;
      z-index: 1000;
      font-size: 50px;
      line-height: 70px;
      text-align: center;
      user-select: none;
    }

    @keyframes floatUp {
  0% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  40% {
    transform: translateY(-30px) scale(1.3);
    opacity: 1;
  }
  100% {
    transform: translateY(-80px) scale(1.7);
    opacity: 0;
  }
}

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #rewardLoadingModal div {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    #rewardAvailableModal.show {
      animation: zoomInFromFar 0.6s ease forwards;
    }

    #spinner {
      animation: spin 2s linear infinite;
    }

    #confetti-canvas {
      position: fixed;
      top: 0; left: 0;
      width: 100vw;
      height: 100vh;
      pointer-events: none;
      z-index: 10000;
      display: none;
    }

    @keyframes sparkle {
      0%, 100% {opacity: 0.8;}
      50% {opacity: 0.4;}
    }

    @keyframes glow {
      0% { text-shadow: 0 0 10px #d6336c;}
      100% { text-shadow: 0 0 20px #ff90b3;}
    }
  </style>
</head>
<body>
  <canvas id="confetti-canvas"></canvas>
  <p id="description" style="
    font-size: 15px;
    color: #d6336c;
    margin-bottom: 10px;
    text-align: center;
    max-width: 700px;
    line-height: 1.4;
    position: relative;
    animation: glow 3s ease-in-out infinite alternate;
  ">
    –û—Ç–ø—Ä–∞–≤–ª—è–π –∫–∞—Å–∞–Ω–∏—è –∏ –ø–æ—Ü–µ–ª—É–π—á–∏–∫–∏ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥—Ä—É–≥—É –∏–ª–∏ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.<br>
    –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ –Ω–∞–±–µ—Ä—ë—Ç–µ <strong>1000</strong> –∫–∞—Å–∞–Ω–∏–π, –≤–∞—Å –∂–¥—ë—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ üíù
    <span class="sparkle" style="
      position: absolute;
      top: -8px;
      right: -12px;
      width: 10px;
      height: 10px;
      background: radial-gradient(circle, #ff90b3 20%, transparent 70%);
      border-radius: 50%;
      animation: sparkle 1.8s infinite ease-in-out;
      opacity: 0.8;
      pointer-events: none;
    "></span>
  </p>
  
<div id="pulseDots" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000;">
  <svg width="80" height="24" viewBox="0 0 80 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="10" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" repeatCount="indefinite"/>
    </circle>
    <circle cx="40" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.2s" repeatCount="indefinite"/>
    </circle>
    <circle cx="70" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.4s" repeatCount="indefinite"/>
    </circle>
  </svg>
</div>

  <!-- –ü–∞–Ω–µ–ª—å –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏ -->
<div id="emojiPicker" style="margin-bottom: 15px; user-select: none;">
  <span style="font-size: 30px; cursor: pointer; margin: 0 8px;" data-emoji="‚ù§Ô∏è">‚ù§Ô∏è</span>
  <span style="font-size: 30px; cursor: pointer; margin: 0 8px;" data-emoji="üå∏">üå∏</span>
  <span style="font-size: 30px; cursor: pointer; margin: 0 8px;" data-emoji="‚ú®">‚ú®</span>
  <span style="font-size: 30px; cursor: pointer; margin: 0 8px;" data-emoji="üí©">üí©</span>
  <span style="font-size: 30px; cursor: pointer; margin: 0 8px;" data-emoji="üíã">üíã</span>
  <span style="font-size: 30px; cursor: pointer; margin: 0 8px;" data-emoji="üî•">üî•</span>
</div>

  <div id="counter" role="button" aria-label="–°—á—ë—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π">–¢—ã: 0 | –î—Ä—É–≥: 0</div>

  <div id="progressModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="progressTitle" aria-describedby="progressDesc">
    <h3 id="progressTitle">üíñ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
    <p>–¢—ã: <span id="progressMy">0</span></p>
    <p>–î—Ä—É–≥: <span id="progressFriend">0</span></p>
    <p>–í—Å–µ–≥–æ: <span id="progressTotal">0</span></p>
    <p>–î–æ –ø–æ–¥–∞—Ä–∫–∞ –æ—Å—Ç–∞–ª–æ—Å—å: <span id="progressLeft">1000</span></p>
    <button id="closeProgressBtn">–û–∫</button>
  </div>

  <div id="rewardAvailableModal" class="modal">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
    <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ <strong>1000 –∫–∞—Å–∞–Ω–∏–π</strong><br>–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–¥–∞—Ä–æ–∫!</p>
    <button id="openRewardBtn">–ü–æ–ª—É—á–∏—Ç—å</button>
  </div>

  <div id="rewardLoadingModal" class="modal">
    <h2>üéÅ –û—Ç–∫—Ä—ã–≤–∞–µ–º –ø–æ–¥–∞—Ä–æ–∫...</h2>
    <div style="margin-top: 20px; font-size: 24px;">‚è≥</div>
  </div>

  <div id="rewardResultModal" class="modal">
    <h2>–£—Ä–∞! üéâ</h2>
    <p id="rewardResultText">–í–∞–º –≤—ã–ø–∞–ª Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!</p>
    <button id="closeRewardBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    let myTouches = 0;
    let friendTouches = 0;
    let totalTouches = 0;

    const counter = document.getElementById('counter');
    const progressModal = document.getElementById('progressModal');
    const rewardAvailableModal = document.getElementById('rewardAvailableModal');
    const rewardLoadingModal = document.getElementById('rewardLoadingModal');
    const rewardResultModal = document.getElementById('rewardResultModal');

    const progressMy = document.getElementById('progressMy');
    const progressFriend = document.getElementById('progressFriend');
    const progressTotal = document.getElementById('progressTotal');
    const progressLeft = document.getElementById('progressLeft');

    const closeProgressBtn = document.getElementById('closeProgressBtn');
    const openRewardBtn = document.getElementById('openRewardBtn');
    const closeRewardBtn = document.getElementById('closeRewardBtn');

    let lastMyTouches = 0;
    let lastFriendTouches = 0;
    let rewardClaimed = false;

    function animateNumber(element, start, end, duration = 300) {
      const startTime = performance.now();

      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        const currentValue = Math.floor(start + (end - start) * progress);
        element.textContent = currentValue;
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      requestAnimationFrame(update);
    }

function createRandomEmoji(x, y, emoji) {
  const emojisSet = ['‚ù§Ô∏è', 'üå∏', '‚ú®', 'üí©', 'üíã', 'üî•'];
  const chosenEmoji = emoji || selectedEmoji || emojisSet[0];
  const span = document.createElement('span');
  span.className = 'heart';
  span.textContent = chosenEmoji;
  span.style.left = (x - 20) + 'px';
  span.style.top = (y - 20) + 'px';
  document.body.appendChild(span);
  setTimeout(() => {
    span.remove();
  }, 1700);
}

function updateEmojiPickerUI(selected) {
  [...emojiPicker.children].forEach(span => {
    span.style.border = span.dataset.emoji === selected ? '2px solid #d6336c' : 'none';
    span.style.borderRadius = '6px';
  });
}
updateEmojiPickerUI(selectedEmoji);
    
    function updateCounter() {
      counter.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
    }

    function updateProgressModal() {
  progressMy.textContent = myTouches;
  progressFriend.textContent = friendTouches;
  totalTouches = myTouches + friendTouches;
  progressTotal.textContent = totalTouches;
  progressLeft.textContent = Math.max(1000 - totalTouches, 0);
}
    function openModal(modal) {
      isModalOpen = true;
      modal.classList.add('show');
    }

    function closeModal(modal) {
       isModalOpen = false;
      modal.classList.remove('show');
    }

    function checkReward() {
      totalTouches = myTouches + friendTouches;
      if (totalTouches >= 10 && !rewardAvailableModal.classList.contains('show') && !rewardClaimed) {
        openModal(rewardAvailableModal);
      }
    }

    closeProgressBtn.onclick = () => closeModal(progressModal);
    openRewardBtn.onclick = () => {
      closeModal(rewardAvailableModal);
      openModal(rewardLoadingModal);
      setTimeout(() => {
        closeModal(rewardLoadingModal);
        showRandomReward();
      }, 2000);
    };

    function showRandomReward() {
      const gifts = [
        'Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!',
        'Telegram Premium –Ω–∞ 1 –º–µ—Å—è—Ü!',
        '–ó–≤–µ–∑–¥—ã 250 —à—Ç—É–∫!',
        '–ó–≤–µ–∑–¥—ã 500 —à—Ç—É–∫!',
      ];
      const randomGift = gifts[Math.floor(Math.random() * gifts.length)];
      document.getElementById('rewardResultText').innerHTML = `–í–∞–º –≤—ã–ø–∞–ª:<br><strong>${randomGift}</strong>`;
      openModal(rewardResultModal);
      startConfetti();
    }

    closeRewardBtn.onclick = () => {
      rewardClaimed = true;
      closeModal(rewardResultModal);
      const pulse = document.getElementById('pulseDots');
  pulse.style.display = 'block';
       setTimeout(() => {
    pulse.style.display = 'none';
    alert('–ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! üéÅ');
  }, 2000);
};

    counter.addEventListener('click', () => {
      openModal(progressModal);
    });

    // –ü–æ–¥–∫–ª—é—á–∞–µ–º Socket.IO
const socket = io('https://immense-fantasy-turret.glitch.me'); // –∞–¥—Ä–µ—Å —Ç–≤–æ–µ–≥–æ —Å–µ—Ä–≤–µ—Ä–∞
const roomId = (window.Telegram && window.Telegram.WebApp && window.Telegram.WebApp.initDataUnsafe)
  ? window.Telegram.WebApp.initDataUnsafe.chat.id
  : 'default_room';

// –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ WebSocket-—Å–µ—Ä–≤–µ—Ä—É
socket.on('connect', () => {
  console.log('üß† –ü–æ–¥–∫–ª—é—á–∏–ª–∏—Å—å –∫ WebSocket-—Å–µ—Ä–≤–µ—Ä—É');
  socket.emit('joinRoom', roomId);
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫, –∫–æ–≥–¥–∞ –¥—Ä—É–≥–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç —ç–º–æ–¥–∑–∏
socket.on('emojiSelected', ({ emoji, x, y }) => {
  friendTouches++;  // –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Å–∞–Ω–∏–π –¥—Ä—É–≥–∞
  updateCounter();  // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π
  createRandomEmoji(x, y, emoji);  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —ç–º–æ–¥–∑–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
  checkReward();  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –Ω–∞–≥—Ä–∞–¥—ã
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
socket.on('touch', ({ x, y, emoji }) => {
  friendTouches++;
  updateCounter();
  updateProgressModal();
  createRandomEmoji(x, y, emoji);  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
  checkReward();
});

// –û—Ç–ø—Ä–∞–≤–∫–∞ —ç–º–æ–¥–∑–∏ –∏ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä
function sendTouch(x, y, emoji) {
  socket.emit('touch', { roomId, x, y, emoji });
}

function sendEmoji(emoji, x, y) {
  socket.emit('emojiSelected', { roomId, emoji, x, y });
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏—è –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
let touchCooldown = false;
let isModalOpen = false;
let selectedEmoji = '‚ù§Ô∏è';  // –≠–º–æ–¥–∑–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
let myTouches = 0;

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–∞—Å–∞–Ω–∏—è
function handleTouch(x, y) {
  if (touchCooldown || isModalOpen) return;
  touchCooldown = true;

  myTouches++;
  updateCounter();
  updateProgressModal();
  
  createRandomEmoji(x, y, selectedEmoji);  // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —ç–º–æ–¥–∑–∏ –Ω–∞ —ç–∫—Ä–∞–Ω–µ
  sendTouch(x, y, selectedEmoji);  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞—Å–∞–Ω–∏–µ —Å —ç–º–æ–¥–∑–∏

  checkReward();  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–≥—Ä–∞–¥—ã

  setTimeout(() => (touchCooldown = false), 100);  // –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∫–∞—Å–∞–Ω–∏—è–º–∏
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—ã–±–æ—Ä–∞ —ç–º–æ–¥–∑–∏
const emojiPicker = document.getElementById('emojiPicker');
emojiPicker.addEventListener('click', (e) => {
  const target = e.target;
  if (target.dataset && target.dataset.emoji) {
    selectedEmoji = target.dataset.emoji;  // –û–±–Ω–æ–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —ç–º–æ–¥–∑–∏

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–µ —ç–º–æ–¥–∑–∏ –¥—Ä—É–≥–∏–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
    sendEmoji(selectedEmoji, Math.random() * window.innerWidth, Math.random() * window.innerHeight);
  }

  // –û–±–Ω–æ–≤–ª—è–µ–º UI –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏
  updateEmojiPickerUI(selectedEmoji);
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤—ã–¥–µ–ª–µ–Ω–∏—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏
function updateEmojiPickerUI(selected) {
  [...emojiPicker.children].forEach(span => {
    span.style.border = span.dataset.emoji === selected ? '2px solid #d6336c' : 'none';
    span.style.borderRadius = '6px';
  });
}

// –õ–æ–≤–∏–º touchstart –∏ click (–¥–ª—è –¥–µ—Å–∫—Ç–æ–ø–∞)
let ignoreClick = false;

document.body.addEventListener('touchstart', e => {
  if (e.target === counter) return;
  const touch = e.touches[0];
  handleTouch(touch.clientX, touch.clientY);  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–∞—Å–∞–Ω–∏–µ
  ignoreClick = true;
  setTimeout(() => {
    ignoreClick = false;
  }, 300);  // 500 –º—Å ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ, —á—Ç–æ–±—ã –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–∫ –ø–æ—Å–ª–µ –∫–∞—Å–∞–Ω–∏—è
});

document.body.addEventListener('pointerdown', e => {
  if (e.target === counter) return;
  handleTouch(e.clientX, e.clientY);  // –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∫–ª–∏–∫
});

    // –ê–Ω–∏–º–∞—Ü–∏—è –∫–æ–Ω—Ñ–µ—Ç—Ç–∏
   const confettiCanvas = document.createElement('canvas');
const ctx = confettiCanvas.getContext('2d');
document.body.appendChild(confettiCanvas);

let W = window.innerWidth;
let H = window.innerHeight;

confettiCanvas.width = W;
confettiCanvas.height = H;
confettiCanvas.style.position = 'fixed';
confettiCanvas.style.top = '0';
confettiCanvas.style.left = '0';
confettiCanvas.style.pointerEvents = 'none';
confettiCanvas.style.zIndex = '9999';

class Confetti {
  constructor() {
    this.x = Math.random() * W;
    this.y = Math.random() * H - H;
    this.size = 15; // —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ä–∞–∑–º–µ—Ä
    this.speedY = 3 + Math.random() * 1; // –ø–æ—Å—Ç–æ—è–Ω–Ω–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å –ø–∞–¥–µ–Ω–∏—è
    this.speedX = (Math.random() - 0.5) * 1; // –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑–±—Ä–æ—Å –ø–æ X
    this.opacity = 1;

    this.rotation = Math.random() * 360;
    this.rotationSpeed = (Math.random() - 0.5) * 5;

    this.colorHue = Math.floor(Math.random() * 360);
  }

  update() {
    this.y += this.speedY;
    this.x += this.speedX;
    this.rotation += this.rotationSpeed;

    if (this.x > W) this.x = 0;
    if (this.x < 0) this.x = W;

    if (this.y > H + this.size) {
      this.reset();
    }
  }

  reset() {
    this.x = Math.random() * W;
    this.y = -this.size;
    this.opacity = 1;
    this.size = 15;
    this.speedY = 3 + Math.random();
    this.speedX = (Math.random() - 0.5) * 1;
    this.rotation = Math.random() * 360;
    this.rotationSpeed = (Math.random() - 0.5) * 5;
    this.colorHue = Math.floor(Math.random() * 360);
  }

  draw(ctx) {
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.rotation * Math.PI / 180);

    const grad = ctx.createLinearGradient(-this.size/2, -this.size/2, this.size/2, this.size/2);
    grad.addColorStop(0, `hsl(${this.colorHue}, 90%, 75%)`);
    grad.addColorStop(0.5, `hsl(${this.colorHue}, 100%, 50%)`);
    grad.addColorStop(1, `hsl(${this.colorHue}, 90%, 75%)`);

    ctx.fillStyle = grad;
    ctx.shadowColor = `hsl(${this.colorHue}, 100%, 70%)`;
    ctx.shadowBlur = 6;

    ctx.globalAlpha = this.opacity;

    // –¢–æ–ª—å–∫–æ –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∏, —á—É—Ç—å —Ç–æ–Ω—å—à–µ
    ctx.fillRect(-this.size / 2, -this.size / 6, this.size, this.size / 3);

    ctx.restore();
  }
}

let confettiPieces = [];
const CONFETTI_COUNT = 300;

function initConfetti() {
  confettiPieces = [];
  for (let i = 0; i < CONFETTI_COUNT; i++) {
    confettiPieces.push(new Confetti());
  }
}

function render() {
  ctx.clearRect(0, 0, W, H);
  confettiPieces.forEach(c => {
    c.update();
    c.draw(ctx);
  });
  requestAnimationFrame(render);
}

function startConfetti() {
  confettiCanvas.style.display = 'block';
  confettiCanvas.style.opacity = '1';
  initConfetti();
  render();

  // –ù–∞—á–∏–Ω–∞–µ–º –ø–ª–∞–≤–Ω–æ–µ –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã
  let fadeDuration = 4000;
  let startTime = null;

  function fadeOut(timestamp) {
    if (!startTime) startTime = timestamp;
    let elapsed = timestamp - startTime;
    let progress = Math.min(elapsed / fadeDuration, 1);
    confettiCanvas.style.opacity = 1 - progress;

    // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–æ–Ω—Ñ–µ—Ç—Ç–∏ –ø–ª–∞–≤–Ω–æ —É–º–µ–Ω—å—à–∞–µ–º opacity
    confettiPieces.forEach(c => {
      c.opacity = 1 - progress;
    });

    if (progress < 1) {
      requestAnimationFrame(fadeOut);
    } else {
      confettiCanvas.style.display = 'none';
      confettiPieces = [];
    }
  }

  requestAnimationFrame(fadeOut);
}

const emojiButtons = document.querySelectorAll('.emojiBtn');
emojiButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    selectedEmoji = btn.textContent;
    emojiButtons.forEach(btn => {
  btn.addEventListener('click', () => {
    selectedEmoji = btn.textContent;
    emojiButtons.forEach(b => b.style.opacity = '0.5');
    btn.style.opacity = '1';

    if (socket && socket.readyState === WebSocket.OPEN) {
      socket.send(JSON.stringify({
        type: 'emojiChange',
        emoji: selectedEmoji,
        userId: myUserId  // –µ—Å–ª–∏ –µ—Å—Ç—å –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    // –ü–æ–¥—Å–≤–µ—Ç–∏—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É (—á—Ç–æ–±—ã –±—ã–ª–æ –≤–∏–¥–Ω–æ, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–æ)
    emojiButtons.forEach(b => b.style.opacity = '0.5');
    btn.style.opacity = '1';
   }));
    }
  });
});
// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–¥—Å–≤–µ—Ç–∫–∏ –¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —ç–º–æ–¥–∑–∏
emojiButtons.forEach(b => {
  if (b.textContent === selectedEmoji) {
    b.style.opacity = '1';
  } else {
    b.style.opacity = '0.5';
  }
});

window.addEventListener('resize', () => {
  W = window.innerWidth;
  H = window.innerHeight;
  confettiCanvas.width = W;
  confettiCanvas.height = H;
});


  </script>
</body>
</html>

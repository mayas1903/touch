<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Touch Me Softly</title>
  <style>
    body {
      position: relative;
      margin: 0;
      padding: 20px;
      background-image: url('https://i.postimg.cc/xdfHJk7x/042-FACF6-1710-454-B-84-F0-C2-D64859-AD77.jpg');
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
        Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      user-select: none;
      overflow: hidden;
      height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .heart {
      position: absolute;
      width: 40px;
      height: 40px;
      pointer-events: none;
      animation: floatUp 1.7s ease forwards;
      opacity: 1;
      z-index: 1000;
      font-size: 35px;
      line-height: 70px;
      text-align: center;
      user-select: none;
    }
    
    #counter {
      font-size: 18px;
      background: #ffe6f0;
      color: #d6336c;
      border-radius: 16px;
      padding: 12px 20px;
      margin-bottom: 10px;
      box-shadow: 0 6px 15px rgba(255, 182, 193, 0.6);
      cursor: pointer;
      position: relative;
      z-index: 10;
      width: fit-content;
    }
    #counter:hover {
      background: #ffccdd;
    }

    .modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -60%);
      background: #fefefe;
      border-radius: 20px;
      width: 270px;
      max-width: 90vw;
      padding: 20px 22px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
      font-size: 16px;
      color: #111;
      text-align: center;
      box-sizing: border-box;
      user-select: none;
      word-wrap: break-word;
      z-index: 11000 !important;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.25s ease-in-out, transform 0.25s ease-in-out;
      backdrop-filter: blur(10px);
    }

    .modal.show {
      opacity: 1;
      pointer-events: auto;
      transform: translate(-50%, -50%);
    }

    .modal h2, .modal h3 {
      font-weight: 600;
      margin-bottom: 12px;
    }

    .modal p {
      margin: 6px 0;
      line-height: 1.4;
      color: #333;
    }

    .modal button {
      margin-top: 18px;
      background: #007aff;
      border: none;
      color: white;
      padding: 10px 22px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: background 0.25s ease;
    }

    .modal button:hover {
      background: #005ecb;
    }

.gift-box {
  font-size: 60px;
  cursor: pointer;
  user-select: none;
  transition: transform 0.3s ease, filter 0.3s ease;
  animation: pulseGift 2s infinite ease-in-out;
}

.gift-box:hover {
  transform: scale(1.2) rotate(-5deg);
  filter: brightness(1.2);
}

/* üîÅ –ü—É–ª—å—Å–∞—Ü–∏—è */
@keyframes pulseGift {
  0%, 100% {
    transform: scale(1);
    opacity: 1;
  }
  50% {
    transform: scale(1.15);
    opacity: 0.9;
  }
}
/* üé¨ –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–æ—Ä–æ–±–∫–∏ */
@keyframes boxOpen {
  0%   { transform: scale(1) rotate(0deg); opacity: 1; }
  50%  { transform: scale(1.4) rotate(10deg); }
  100% { transform: scale(0) rotate(-30deg); opacity: 0; }
}
.gift-box.opened {
  animation: boxOpen 0.6s ease forwards;
}


    @keyframes floatUp {
  0% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  40% {
    transform: translateY(-30px) scale(1.3);
    opacity: 1;
  }
  100% {
    transform: translateY(-80px) scale(1.7);
    opacity: 0;
  }
}

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    #rewardLoadingModal div {
      display: inline-block;
      animation: spin 1s linear infinite;
    }

    #rewardAvailableModal.show {
      animation: zoomInFromFar 0.6s ease forwards;
    }

    #spinner {
      animation: spin 2s linear infinite;
    }

    @keyframes sparkle {
      0%, 100% {opacity: 0.8;}
      50% {opacity: 0.4;}
    }

    @keyframes glow {
      0% { text-shadow: 0 0 10px #d6336c;}
      100% { text-shadow: 0 0 20px #ff90b3;}
    }
    
    #helpModal {
  font-size: 14px; 
}
    
.emojiChoice {
  cursor: pointer;
  font-size: 32px; /* —á—É—Ç—å –∫—Ä—É–ø–Ω–µ–µ */
  padding: 10px;
  margin: 4px;
  border-radius: 10px;
  transition: transform 0.2s ease, box-shadow 0.2s ease;
  background: transparent;
}
.emojiChoice.selected {
  transform: scale(1.3);
  box-shadow: 0 0 10px #ff69b4;
  background: #fff0f5;
}
   #emojiSelector {
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  margin: 20px auto;  /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–≤–µ—Ä—Ö—É/—Å–Ω–∏–∑—É */
  gap: 8px;            /* –†–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —ç–º–æ–¥–∑–∏ */
  max-width: 90%;
  z-index: 1000;
} 
    
@keyframes sway {
  0%   { transform: translateX(0px) rotate(0deg); }
  25%  { transform: translateX(-5px) rotate(-5deg); }
  50%  { transform: translateX(0px) rotate(0deg); }
  75%  { transform: translateX(5px) rotate(5deg); }
  100% { transform: translateX(0px) rotate(0deg); }
}
.dual-progress-container {
  width: 100%;
  height: 20px;
  background: #fefefe;
  border-radius: 12px;
  overflow: hidden;
  display: flex;
  margin-top: 12px;
  position: relative;
  box-shadow: inset 0 2px 6px rgba(0,0,0,0.1);
}

.progress-part {
  height: 100%;
  transition: width 0.5s ease;
  position: relative;
  z-index: 1;
}

.my-part {
  background: linear-gradient(135deg, #ff69b4, #ff1493);
}

.friend-part {
  background: linear-gradient(135deg, #87cefa, #1e90ff);
}

.my-part::before,
.friend-part::before {
  content: '';
  position: absolute;
  top: -50%;
  left: 0;
  width: 200%;
  height: 200%;
  background: inherit;
  border-radius: 50%;
  animation: waveMotion 4s infinite linear;
  opacity: 0.3;
  transform: translateY(0) scaleX(1.5);
  z-index: 0;
}

@keyframes waveMotion {
  0%   { transform: translateX(0) translateY(0) scaleX(1.5); }
  50%  { transform: translateX(-25%) translateY(-5%) scaleX(1.5); }
  100% { transform: translateX(0) translateY(0) scaleX(1.5); }
}

  </style>
</head>
<body>

  <!-- –ö–Ω–æ–ø–∫–∞ –ø–æ–º–æ—â–∏ -->
<div id="helpButton" style="
  position: fixed;
  bottom: 20px;
  left: 20px;
  width: 42px;
  height: 42px;
  background: #ffb6c1;
  border-radius: 50%;
  color: white;
  font-size: 26px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
  z-index: 9999;
">?</div>

<!-- –ú–æ–¥–∞–ª–∫–∞ –ø–æ–º–æ—â–∏ -->
<div id="helpModal" class="modal">
  <h3>‚ÑπÔ∏è –û –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏</h3>
  <p>
    –û—Ç–ø—Ä–∞–≤–ª—è–π –∫–∞—Å–∞–Ω–∏—è –∏ –ø–æ—Ü–µ–ª—É–π—á–∏–∫–∏ –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏ –¥—Ä—É–≥—É –∏–ª–∏ –ª—é–±–∏–º–æ–º—É —á–µ–ª–æ–≤–µ–∫—É.<br>
    –ö–æ–≥–¥–∞ –≤–º–µ—Å—Ç–µ –Ω–∞–±–µ—Ä—ë—Ç–µ <strong>1–∫, 2–∫, 3–∫...</strong> –∫–∞—Å–∞–Ω–∏–π, –≤–∞—Å –∂–¥—ë—Ç –ø—Ä–∏—è—Ç–Ω—ã–π —Å—é—Ä–ø—Ä–∏–∑ üíù
  </p>
  <button onclick="closeModal(helpModal)">–ü–æ–Ω—è—Ç–Ω–æ</button>
</div>

 <div id="boxSelectionModal" class="modal">
  <h3>ü§© –í—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –∫–æ—Ä–æ–±–æ—á–µ–∫:</h3>
  <div style="display: flex; justify-content: space-around; margin-top: 40px;">
    <div class="gift-box" data-box="1">üéÅ</div>
    <div class="gift-box" data-box="2">üéÅ</div>
    <div class="gift-box" data-box="3">üéÅ</div>
  </div>
</div>
  
  <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∫–∏ -->
<button id="noteButton" style="margin-top: 10px; padding: 10px 20px; border-radius: 12px; background: #ff69b4; color: white; border: none; font-size: 16px; cursor: pointer;">üíå –ù–∞–ø–∏—Å–∞—Ç—å –∑–∞–ø–∏—Å–∫—É</button>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∑–∞–ø–∏—Å–∏ -->
<div id="noteModal" class="modal">
  <h3>–û—Å—Ç–∞–≤–∏—Ç—å –∑–∞–ø–∏—Å–∫—É</h3>
  <textarea id="noteText" maxlength="140" rows="4" placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø–∏—Å–∫—É..." style="width: 100%; border-radius: 8px; padding: 8px;"></textarea>
  <p style="margin-top: 10px;">–ü–æ–∫–∞–∑–∞—Ç—å, –∫–æ–≥–¥–∞ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç–æ:</p>
  <input id="noteThreshold" type="number" min="1" max="10000" value="50" style="width: 100%; padding: 8px; border-radius: 8px;" />
  <button id="saveNoteBtn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–∫–∞–∑–∞ –∑–∞–ø–∏—Å–∫–∏ -->
<div id="noteRevealModal" class="modal">
  <h3>üì© –°–æ–æ–±—â–µ–Ω–∏–µ</h3>
  <p id="revealedNoteText"></p>
  <button onclick="closeModal(noteRevealModal)">–û–∫</button>
</div>
  
<div id="pulseDots" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 2000;">
  <svg width="80" height="24" viewBox="0 0 80 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <circle cx="10" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" repeatCount="indefinite"/>
    </circle>
    <circle cx="40" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.2s" repeatCount="indefinite"/>
    </circle>
    <circle cx="70" cy="12" r="8" fill="#FF69B4">
      <animate attributeName="r" values="8;12;8" dur="1s" begin="0.4s" repeatCount="indefinite"/>
    </circle>
  </svg>
</div>
  
  <div id="emojiSelector">
  <span class="emojiChoice">‚ù§Ô∏è</span>
  <span class="emojiChoice">üå∏</span>
  <span class="emojiChoice">‚ú®</span>
  <span class="emojiChoice">üí©</span>
  <span class="emojiChoice">üíã</span>
  <span class="emojiChoice">üî•</span>
</div>

  
  <div id="counter" role="button" aria-label="–°—á—ë—Ç—á–∏–∫ –∫–∞—Å–∞–Ω–∏–π">–¢—ã: 0 | –î—Ä—É–≥: 0</div>
  
  <div id="progressModal" class="modal" role="dialog" aria-modal="true">
  <h3 id="progressTitle">üíñ –í–∞—à –ø—Ä–æ–≥—Ä–µ—Å—Å</h3>
  <p id="progressSummary">–¢—ã: 0 | –î—Ä—É–≥: 0</p>
  <div class="dual-progress-container">
    <div id="myProgress" class="progress-part my-part"></div>
    <div id="friendProgress" class="progress-part friend-part"></div>
  </div>
  <p style="margin-top: 8px; font-size: 16px; color: #888;" id="progressText">0 / 1000</p>
  <button id="closeProgressBtn">–û–∫</button>
</div>


  <div id="rewardAvailableModal" class="modal">
    <h2>üéâ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</h2>
    <p>–í—ã —Å–æ–±—Ä–∞–ª–∏ <strong>1000 –∫–∞—Å–∞–Ω–∏–π</strong><br>–í–∞–º –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ–¥–∞—Ä–æ–∫!</p>
    <button id="openRewardBtn">–ü–æ–ª—É—á–∏—Ç—å</button>
  </div>

  <div id="rewardLoadingModal" class="modal">
    <h2>üî• –ó–∞–≥—Ä—É–∑–∫–∞...</h2>
    <div style="margin-top: 20px; font-size: 24px;">‚è≥</div>
  </div>

  <div id="rewardResultModal" class="modal">
    <h2>–£—Ä–∞! üéâ</h2>
    <p id="rewardResultText">–í–∞–º –≤—ã–ø–∞–ª Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!</p>
    <button id="closeRewardBtn">–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å</button>
  </div>

  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <script>
    // --- –û–ë–©–ò–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ---
  let myTouches = 0;
  let friendTouches = 0;
  let totalTouches = 0;
  let touchCooldown = false;
  let isModalOpen = false;   // <-- –æ–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º
  let savedNote = null;
  let noteThreshold = 0;
  let noteShown = false;
  let rewardClaimed = false;
  let selectedEmoji = '‚ù§Ô∏è';

  // --- –≠–õ–ï–ú–ï–ù–¢–´ DOM ---
  const counter = document.getElementById('counter');
  const progressModal = document.getElementById('progressModal');
  const rewardAvailableModal = document.getElementById('rewardAvailableModal');
  const rewardLoadingModal = document.getElementById('rewardLoadingModal');
  const rewardResultModal = document.getElementById('rewardResultModal');
  const noteModal = document.getElementById('noteModal');
  const noteRevealModal = document.getElementById('noteRevealModal');

  const progressSummary = document.getElementById('progressSummary');
  const progressText    = document.getElementById('progressText');
  const myProgress      = document.getElementById('myProgress');
  const friendProgress  = document.getElementById('friendProgress');

  const closeProgressBtn = document.getElementById('closeProgressBtn');
  const openRewardBtn    = document.getElementById('openRewardBtn');
  const closeRewardBtn   = document.getElementById('closeRewardBtn');
  const saveNoteBtn      = document.getElementById('saveNoteBtn');
  const noteTextElm      = document.getElementById('noteText');
  const noteThresholdEl  = document.getElementById('noteThreshold');

  const helpButton = document.getElementById('helpButton');
  const helpModal   = document.getElementById('helpModal');

  // --- –§–£–ù–ö–¶–ò–ò –ú–û–î–ê–õ–û–ö ---
  function openModal(modal) {
    updateProgressModal();  // –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –ø–µ—Ä–µ–¥ –ø—Ä–æ–≥—Ä–µ—Å—Å–æ–º –≤—Å—ë –æ–±–Ω–æ–≤–ª–µ–Ω–æ
    isModalOpen = true;
    modal.classList.add('show');
  }
  function closeModal(modal) {
    isModalOpen = false;
    modal.classList.remove('show');
  }

  // --- –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ß–Å–¢–ß–ò–ö–ê –ò –ü–†–û–ì–†–ï–°–°–ê ---
  function updateCounter() {
    counter.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
  }
  function updateProgressModal() {
    totalTouches = myTouches + friendTouches;
    progressSummary.textContent = `–¢—ã: ${myTouches} | –î—Ä—É–≥: ${friendTouches}`;
    progressText.textContent    = `${totalTouches} / 1000`;
    const max = 1000;
    myProgress.style.width     = `${Math.min(myTouches / max * 100, 100)}%`;
    friendProgress.style.width = `${Math.min(friendTouches / max * 100, 100)}%`;
  }

  // --- –û–ë–†–ê–ë–û–¢–ö–ê –ó–ê–ü–ò–°–û–ö –ò –ü–û–î–ê–†–ö–û–í ---
  saveNoteBtn.onclick = () => {
    const text = noteTextElm.value.trim();
    const thr  = parseInt(noteThresholdEl.value, 10);
    if (text && thr > 0) {
      savedNote    = text;
      noteThreshold = thr;
      closeModal(noteModal);
      alert(`‚úâÔ∏è –ó–∞–ø–∏—Å–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞. –ü–æ—è–≤–∏—Ç—Å—è –ø—Ä–∏ ${thr} –∫–∞—Å–∞–Ω–∏—è—Ö.`);
    }
  };

  function checkReward() {
    totalTouches = myTouches + friendTouches;
    if (totalTouches >= 10 && !rewardClaimed) {
      openModal(rewardAvailableModal);
    }
    if (savedNote && totalTouches >= noteThreshold && !noteShown) {
      document.getElementById('revealedNoteText').textContent = savedNote;
      openModal(noteRevealModal);
      noteShown = true;
    }
  }

  // --- –û–ë–†–ê–ë–û–¢–ö–ê –ö–ù–û–ü–û–ö –ò –°–û–ë–´–¢–ò–ô ---
  closeProgressBtn.onclick = () => closeModal(progressModal);
  openRewardBtn.onclick    = () => {
    closeModal(rewardAvailableModal);
    openModal(rewardLoadingModal);
    setTimeout(() => {
      closeModal(rewardLoadingModal);
      openModal(document.getElementById('boxSelectionModal'));
    }, 2000);
  };
  closeRewardBtn.onclick = () => {
    rewardClaimed = true;
    closeModal(rewardResultModal);
    alert('–ü–æ–¥–∞—Ä–æ–∫ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! üéÅ');
  };

  helpButton.onclick = () => openModal(helpModal);
  counter.onclick = () => openModal(progressModal);
    
    document.querySelectorAll('.gift-box').forEach(box => {
  box.addEventListener('click', () => {
    // –û—Ç–∫–ª—é—á–∞–µ–º –≤—ã–±–æ—Ä, —á—Ç–æ–±—ã –Ω–µ –∫–ª–∏–∫–∞–ª–∏ –ø–æ –¥—Ä—É–≥–∏–º
    document.querySelectorAll('.gift-box').forEach(b => b.style.pointerEvents = 'none');
    // –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
    box.classList.add('opened');
    // ‚è≥ –ñ–¥—ë–º –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
    setTimeout(() => {
      closeModal(document.getElementById('boxSelectionModal'));
      const reward = 'Telegram Premium –Ω–∞ 3 –º–µ—Å—è—Ü–∞!'; // –ú–æ–∂–µ—à—å –¥–æ–±–∞–≤–∏—Ç—å —Ä–∞–Ω–¥–æ–º
      document.getElementById('rewardResultText').textContent = `–í–∞–º –≤—ã–ø–∞–ª ${reward}`;
      startSakuraRain(); // üå∏
      openModal(rewardResultModal);
      // –í–æ–∑–≤—Ä–∞—â–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π)
      document.querySelectorAll('.gift-box').forEach(b => {
        b.classList.remove('opened');
        b.style.pointerEvents = 'auto';
      });
    }, 600); // —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç boxOpen 0.6s
  });
});

    // –í—ã–±–æ—Ä emoji
document.querySelectorAll('.emojiChoice').forEach(el => {
  el.addEventListener('click', () => {
    document.querySelectorAll('.emojiChoice').forEach(e => e.classList.remove('selected'));
    el.classList.add('selected');
    selectedEmoji = el.textContent;
  });
});
    
  // --- –û–ë–†–ê–ë–û–¢–ß–ò–ö –ö–ê–°–ê–ù–ò–ô ---
  function handleTouch(x, y, target) {
    if (touchCooldown || isModalOpen) return;
  const forbidden = ['modal','emojiSelector','emojiChoice','gift-box'];
if (
  forbidden.some(cls => target.closest(`.${cls}`)) ||
  ['counter','helpButton'].includes(target.id) ||
  target.closest('button')
) return;
    touchCooldown = true;
    setTimeout(() => touchCooldown = false, 100);
   myTouches++;
updateCounter();
updateProgressModal();
checkReward();
  // üÜï –î–æ–±–∞–≤–ª—è–µ–º –≤–∏–∑—É–∞–ª—å–Ω—ã–π —ç–º–æ–¥–∑–∏
  const emoji = document.createElement('div');
  emoji.className = 'heart';
  emoji.textContent = selectedEmoji;
  emoji.style.left = `${x - 20}px`;
  emoji.style.top = `${y - 20}px`;
  document.body.appendChild(emoji);
  setTimeout(() => emoji.remove(), 1700);
}
  document.body.addEventListener('pointerdown', e => handleTouch(e.clientX, e.clientY, e.target));

  // --- WEBSOCKET + –≠–ú–û–î–ó–ò ---
  const socket = io('https://immense-fantasy-turret.glitch.me');
  const roomId = window.Telegram?.WebApp?.initDataUnsafe?.chat.id || 'default_room';
  socket.emit('joinRoom', roomId);
  socket.on('connect', () => {
    document.querySelectorAll('.emojiChoice').forEach(el => {
      el.onclick = () => {
        selectedEmoji = el.textContent;
        document.querySelectorAll('.emojiChoice').forEach(e => e.classList.remove('selected'));
        el.classList.add('selected');
      };
    });
    document.querySelectorAll('.emojiChoice')[0].classList.add('selected');
  });
  socket.on('friendTouch', ({x, y, emoji}) => {
  friendTouches++;
  updateCounter();
  updateProgressModal();
  checkReward();
  // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —ç–º–æ–¥–∑–∏ –æ—Ç –¥—Ä—É–≥–∞
  const emojiEl = document.createElement('div');
  emojiEl.className = 'heart';
  emojiEl.textContent = emoji;
  emojiEl.style.left = `${x - 20}px`;
  emojiEl.style.top = `${y - 20}px`;
  document.body.appendChild(emojiEl);
  setTimeout(() => emojiEl.remove(), 1700);
});

function startSakuraRain() {
  const NUM_PETALS = 120;
  const svgMarkup = `
    <svg viewBox="0 0 50 50" xmlns="http://www.w3.org/2000/svg">
      <path d="M25 0 C15 10, 5 25, 25 50 C45 25, 35 10, 25 0 Z" fill="#FFB6C1"/>
    </svg>`;

  // üå¨Ô∏è –ù–∞—Å—Ç—Ä–æ–∏–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ç—Ä–∞:
  const windDirection = Math.random() > 0.5 ? 1 : -1; // 1 = –≤–ø—Ä–∞–≤–æ, -1 = –≤–ª–µ–≤–æ
  const windStrength = 60 + Math.random() * 60; // –æ—Ç 60 –¥–æ 120 px
  const baseWind = windDirection * windStrength;

  for (let i = 0; i < NUM_PETALS; i++) {
    const wrapper = document.createElement('div');
    wrapper.innerHTML = svgMarkup;
    const svg = wrapper.querySelector('svg');

    const size = 20 + Math.random() * 20;
    const startX = Math.random() * window.innerWidth;
    const driftVariance = (Math.random() - 0.5) * 40; // –Ω–µ–º–Ω–æ–≥–æ "—Ä–∞–∑–±—Ä–æ—Å–∞"
    const driftX = baseWind + driftVariance;
    const startY = -50 - Math.random() * 100;

    wrapper.style.position = 'fixed';
    wrapper.style.left = `${startX}px`;
    wrapper.style.top = `${startY}px`;
    wrapper.style.width = `${size}px`;
    wrapper.style.height = `${size}px`;
    wrapper.style.pointerEvents = 'none';
    wrapper.style.zIndex = '9999';
    wrapper.style.transform = 'translate(0, 0)';

    svg.style.width = '100%';
    svg.style.height = '100%';
    svg.style.opacity = '1';
    svg.style.transition = 'opacity 1s ease';
    svg.style.animation = `sway ${3 + Math.random() * 2}s ease-in-out infinite`;

    document.body.appendChild(wrapper);
    const fallDistance = window.innerHeight - startY + 100;
    const delay = Math.random() * 1500;
    setTimeout(() => {
      wrapper.animate([
        { transform: 'translate(0, 0)', opacity: 1 },
        { transform: `translate(${driftX}px, ${fallDistance}px)`, opacity: 0 }
      ], {
        duration: 4000,
        easing: 'ease-in-out',
        fill: 'forwards'
      })
      setTimeout(() => wrapper.remove(), 4200);
    }, delay);
  }
}


  </script>
</body>
</html>
